!function t(e,i,r){function o(a,s){if(!i[a]){if(!e[a]){var h="function"==typeof require&&require;if(!s&&h)return h(a,!0);if(n)return n(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var p=i[a]={exports:{}};e[a][0].call(p.exports,function(t){var i=e[a][1][t];return o(i?i:t)},p,p.exports,t,e,i,r)}return i[a].exports}for(var n="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(t,e,i){"use strict";var r={DEBUG:!0,IMAGES:{title_bg:"image/title_bg.png",prologue1_1_bg:"image/prologue_bg.png",prologue2_bg:"image/prologue_bg.png",logo:"image/logo.png",side_bar:"image/side_bar.png",fukidashi_normal:"image/serif.png",aya_normal:"image/aya_normal.png",ganger_normal:"image/ganger_normal.png",hatena_normal:"image/ganger_normal.png",merry_normal:"image/merry_normal.png",renko_normal:"image/renko_normal.png",name_aya:"image/name_aya.png",name_ganger:"image/name_ganger.png",name_hatena:"image/name_hatena.png",name_merry:"image/name_merry.png",name_renko:"image/name_renko.png",name_yuka:"image/name_yuka.png",name_sanae:"image/name_sanae.png",name_yukari:"image/name_yukari.png",stage1_bg:"image/stage1_bg.png",character_renko:"image/character_renko.png",boss_aya:"image/boss_aya.png",shot:"image/shot.png",enemy:"image/enemy.png"},SOUNDS:{select:{id:1,path:"sound/select.wav",volume:.8}},BGMS:{title:{path:"bgm/title.mp3",volume:.4},prologue:{path:"bgm/prologue.mp3",volume:.4},douchu:{path:"bgm/douchu.wav",volume:.4,loopStart:74.322,loopEnd:120+53.419}},MESSAGE_SPEED:10,PROLOGUE2_LEFT_X:0,PROLOGUE2_LEFT_Y:132,PROLOGUE2_RIGHT_X:283,PROLOGUE2_RIGHT_Y:132,PROLOGUE2_SERIF_WINDOW_X:80,PROLOGUE2_SERIF_WINDOW_Y:0,PROLOGUE2_LEFT_NAME_WINDOW_X:78,PROLOGUE2_LEFT_NAME_WINDOW_Y:420,PROLOGUE2_RIGHT_NAME_WINDOW_X:362,PROLOGUE2_RIGHT_NAME_WINDOW_Y:420};r.ALL_MATERIAL_NUM=Object.keys(r.IMAGES).length+Object.keys(r.SOUNDS).length+Object.keys(r.BGMS).length,e.exports=r},{}],2:[function(t,e,i){"use strict";var r={DEBUG:!0,LOADING_SCENE:0,TITLE_SCENE:1,PROLOGUE1_SCENE:2,PROLOGUE2_SCENE:3,STAGE_SCENE:4,EPILOGUE_SCENE:5,ENDING_SCENE:6,BUTTON_LEFT:1,BUTTON_UP:2,BUTTON_RIGHT:4,BUTTON_DOWN:8,BUTTON_Z:16,BUTTON_X:32,BUTTON_SHIFT:64,BUTTON_SPACE:128,WAY_STATE:0,TALK_STATE:1,BOSS_STATE:2,RESULT_STATE:3,GAMEOVER_STATE:4};e.exports=r},{}],3:[function(t,e,i){"use strict";for(var r=[],o=0;6>o;o++)r.push({appear_frame:100+15*o,x:50+20*o,y:0,vital:1,powerItem:o%2===0?1:0,scoreItem:o%2===1?1:0,vector:[{count:0,vector:{r:2,theta:90,w:0,ra:0,wa:0}},{count:50,vector:{r:2,w:0,ra:0,wa:.01,trange:{max:135},wrange:{max:.5}}}]});for(var o=0;6>o;o++)r.push({appear_frame:300+15*o,x:380-20*o,y:0,vital:1,powerItem:o%2===0?1:0,scoreItem:o%2===1?1:0,vector:[{count:0,vector:{r:2,theta:90,w:0,ra:0,wa:0}},{count:50,vector:{r:2,w:0,ra:0,wa:-.01,trange:{min:45},wrange:{min:-.5}}}]});for(var o=0;6>o;o++)r.push({appear_frame:500+15*o,x:50+20*o,y:0,vital:1,powerItem:o%2===0?1:0,scoreItem:o%2===1?1:0,vector:[{count:0,vector:{r:2,theta:90,w:0,ra:0,wa:0}},{count:50,vector:{r:2,w:0,ra:0,wa:.01,trange:{max:135},wrange:{max:.5}}}]});for(var o=0;6>o;o++)r.push({appear_frame:700+15*o,x:380-20*o,y:0,vital:1,powerItem:o%2===0?1:0,vector:[{count:0,vector:{r:2,theta:90,w:0,ra:0,wa:0}},{count:50,vector:{r:2,w:0,ra:0,wa:-.01,trange:{min:45},wrange:{min:-.5}}}]});for(var o=0;8>o;o++)r.push({appear_frame:900+o*(80-5*o),x:25+o%4*50,y:0,vital:3,powerItem:o%2===0?1:0,shot:[{bullet:0,count:40+o%2*20}],vector:[{count:0,vector:{r:2,theta:90,w:0,ra:0,wa:0}},{count:30+o%2*20,vector:{r:0,theta:90,w:0,ra:0,wa:0}},{count:130+o%2*20,vector:{r:2,theta:90,w:0,ra:0,wa:.1,trange:{max:190}}}]});for(var o=0;8>o;o++)r.push({appear_frame:950+o*(80-5*o),x:455-o%4*50,y:0,vital:3,powerItem:o%2===0?1:0,shot:[{bullet:0,count:40+o%2*20}],vector:[{count:0,vector:{r:2,theta:90,w:0,ra:0,wa:0}},{count:30+o%2*20,vector:{r:0,theta:90,w:0,ra:0,wa:0}},{count:130+o%2*20,vector:{r:2,theta:90,w:0,ra:0,wa:-.1,trange:{min:-10}}}]});for(var o=0;4>o;o++)r.push({appear_frame:1400+20*o,x:50+50*o,y:0,vital:1,powerItem:o%4===0?1:0,scoreItem:o%4===2?1:0,shot:[{bullet:1,count:40}],vector:[{count:0,vector:{r:2,theta:90,w:0,ra:0,wa:0}},{count:30,vector:{r:2,w:0,ra:0,wa:-.01,trange:{min:-30},wrange:{min:-1}}}]});for(var o=0;4>o;o++)r.push({appear_frame:1410+10*o,x:25+50*o,y:0,vital:1,powerItem:o%4===0?1:0,scoreItem:o%4===2?1:0,shot:[{bullet:1,count:40}],vector:[{count:0,vector:{r:2,theta:90,w:0,ra:0,wa:0}},{count:30,vector:{r:2,w:0,ra:0,wa:-.01,trange:{min:-30},wrange:{min:-1}}}]});for(var o=0;4>o;o++)r.push({appear_frame:1420+20*o,x:430-50*o,y:0,vital:1,powerItem:o%4===0?1:0,scoreItem:o%4===2?1:0,shot:[{bullet:1,count:40}],vector:[{count:0,vector:{r:2,theta:90,w:0,ra:0,wa:0}},{count:30,vector:{r:2,w:0,ra:0,wa:.01,trange:{max:210},wrange:{max:1}}}]});for(var o=0;4>o;o++)r.push({appear_frame:1430+10*o,x:455-50*o,y:0,vital:1,powerItem:o%4===0?1:0,scoreItem:o%4===2?1:0,shot:[{bullet:1,count:40}],vector:[{count:0,vector:{r:2,theta:90,w:0,ra:0,wa:0}},{count:30,vector:{r:2,w:0,ra:0,wa:.01,trange:{max:210},wrange:{max:1}}}]});for(var o=0;20>o;o++)r.push({appear_frame:1700+10*parseInt(o/2),x:(o%2===0?50:80)+10*o,y:0,vital:1,powerItem:o%4===0?1:0,scoreItem:o%4===2?1:0,vector:[{count:0,vector:{r:3,theta:90,w:0,ra:0,wa:0}},{count:30,vector:{r:3,w:0,ra:0,wa:-.02,trange:{min:-45},wrange:{min:-1}}},{count:180,vector:{r:3,w:0,ra:0,wa:.02,trange:{max:45},wrange:{max:1}}}]});for(var o=0;20>o;o++)r.push({appear_frame:1900+10*parseInt(o/2),x:(o%2===0?430:400)-10*o,y:0,vital:1,powerItem:o%4===0?1:0,scoreItem:o%4===2?1:0,vector:[{count:0,vector:{r:3,theta:90,w:0,ra:0,wa:0}},{count:30,vector:{r:3,w:0,ra:0,wa:.02,trange:{max:225},wrange:{max:1}}},{count:180,vector:{r:3,w:0,ra:0,wa:-.02,trange:{min:135},wrange:{min:-1}}}]});for(var o=0;8>o;o++)r.push({appear_frame:2300+o*(80-5*o),x:25+o%4*50,y:0,vital:3,powerItem:o%2===0?1:0,scoreItem:o%2===1?1:0,shot:[{bullet:0,count:40+o%2*20}],vector:[{count:0,vector:{r:2,theta:90,w:0,ra:0,wa:0}},{count:30+o%2*20,vector:{r:0,theta:90,w:0,ra:0,wa:0}},{count:130+o%2*20,vector:{r:2,theta:90,w:0,ra:0,wa:.1,trange:{max:190}}}]});for(var o=0;8>o;o++)r.push({appear_frame:2350+o*(80-5*o),x:455-o%4*50,y:0,vital:3,powerItem:o%2===0?1:0,scoreItem:o%2===1?1:0,shot:[{bullet:0,count:40+o%2*20}],vector:[{count:0,vector:{r:2,theta:90,w:0,ra:0,wa:0}},{count:30+o%2*20,vector:{r:0,theta:90,w:0,ra:0,wa:0}},{count:130+o%2*20,vector:{r:2,theta:90,w:0,ra:0,wa:-.1,trange:{min:-10}}}]});for(var o=0;8>o;o++)r.push({appear_frame:2500+o*(80-5*o),x:25+o%4*50,y:0,vital:3,powerItem:o%2===0?1:0,scoreItem:o%2===1?1:0,shot:[{bullet:0,count:40+o%2*20}],vector:[{count:0,vector:{r:2,theta:90,w:0,ra:0,wa:0}},{count:30+o%2*20,vector:{r:0,theta:90,w:0,ra:0,wa:0}},{count:130+o%2*20,vector:{r:2,theta:90,w:0,ra:0,wa:.1,trange:{max:190}}}]});for(var o=0;8>o;o++)r.push({appear_frame:2550+o*(80-5*o),x:455-o%4*50,y:0,vital:3,powerItem:o%2===0?1:0,scoreItem:o%2===1?1:0,shot:[{bullet:0,count:40+o%2*20}],vector:[{count:0,vector:{r:2,theta:90,w:0,ra:0,wa:0}},{count:30+o%2*20,vector:{r:0,theta:90,w:0,ra:0,wa:0}},{count:130+o%2*20,vector:{r:2,theta:90,w:0,ra:0,wa:-.1,trange:{min:-10}}}]});for(var o=0;8>o;o++)r.push({appear_frame:2700+o*(80-5*o),x:25+o%4*50,y:0,vital:3,powerItem:o%2===0?1:0,scoreItem:o%2===1?1:0,shot:[{bullet:0,count:40+o%2*20}],vector:[{count:0,vector:{r:2,theta:90,w:0,ra:0,wa:0}},{count:30+o%2*20,vector:{r:0,theta:90,w:0,ra:0,wa:0}},{count:130+o%2*20,vector:{r:2,theta:90,w:0,ra:0,wa:.1,trange:{max:190}}}]});for(var o=0;8>o;o++)r.push({appear_frame:2750+o*(80-5*o),x:455-o%4*50,y:0,vital:3,powerItem:o%2===0?1:0,scoreItem:o%2===1?1:0,shot:[{bullet:0,count:40+o%2*20}],vector:[{count:0,vector:{r:2,theta:90,w:0,ra:0,wa:0}},{count:30+o%2*20,vector:{r:0,theta:90,w:0,ra:0,wa:0}},{count:130+o%2*20,vector:{r:2,theta:90,w:0,ra:0,wa:-.1,trange:{min:-10}}}]});r.sort(function(t,e){return t.appear_frame-e.appear_frame}),e.exports=r},{}],4:[function(t,e,i){"use strict";var r,o=t("./config"),n=t("./constant"),a=t("./scene/loading"),s=t("./scene/title"),h=t("./scene/prologue1"),u=t("./scene/prologue2"),p=t("./scene/stage"),c=function(t){this.surface=t.getContext("2d"),this.width=Number(t.getAttribute("width")),this.height=Number(t.getAttribute("height")),this.context=new window.AudioContext,this.state=null,this.scenes=[],this.scenes[n.LOADING_SCENE]=new a(this),this.scenes[n.TITLE_SCENE]=new s(this),this.scenes[n.PROLOGUE1_SCENE]=new h(this),this.scenes[n.PROLOGUE2_SCENE]=new u(this),this.scenes[n.STAGE_SCENE]=new p(this),this.images={},this.sounds={},this.bgms={},this.soundflag=0,this.frame_count=0,this.keyflag=0,this.before_keyflag=0};c.prototype={init:function(){this.frame_count=0,this.keyflag=0,this.before_keyflag=0,this.changeScene(n.LOADING_SCENE)},fontLoadingDone:function(){this.state===n.LOADING_SCENE&&this.currentScene().notifyFontLoadingDone()},handleKeyDown:function(t){this.keyflag|=this._keyCodeToBitCode(t.keyCode),t.preventDefault()},handleKeyUp:function(t){this.keyflag&=~this._keyCodeToBitCode(t.keyCode),t.preventDefault()},isKeyDown:function(t){return this.keyflag&t},isKeyPush:function(t){return!(this.before_keyflag&t)&&this.keyflag&t},_keyCodeToBitCode:function(t){var e;switch(t){case 16:e=n.BUTTON_SHIFT;break;case 32:e=n.BUTTON_SPACE;break;case 37:e=n.BUTTON_LEFT;break;case 38:e=n.BUTTON_UP;break;case 39:e=n.BUTTON_RIGHT;break;case 40:e=n.BUTTON_DOWN;break;case 88:e=n.BUTTON_X;break;case 90:e=n.BUTTON_Z}return e},changeScene:function(t){this.state=t,this.currentScene().init()},playBGM:function(t){var e=this,i=o.BGMS[t];e.stopBGM();var r=e.context.createBufferSource();e.audio_source=r,r.buffer=e.bgms[t],r.loop=!0,i.loopStart&&(r.loopStart=i.loopStart),i.loopEnd&&(r.loopEnd=i.loopEnd),r.connect(e.context.destination),r.start=r.start||r.noteOn,r.stop=r.stop||r.noteOff,r.start(0)},stopBGM:function(t){var e=this;e.audio_source&&(console.log("aa"),e.audio_source.stop(0))},playSound:function(t){this.soundflag|=o.SOUNDS[t].id},runPlaySound:function(){for(var t in o.SOUNDS)if(this.soundflag&o.SOUNDS[t].id){this.sounds[t].pause(),this.sounds[t].currentTime=0,this.sounds[t].play(),this.soundflag&=~o.SOUNDS[t].id;break}},getImage:function(t){return this.images[t]},currentScene:function(){return this.scenes[this.state]},clearCanvas:function(){this.surface.clearRect(0,0,this.width,this.height)},run:function(){this.currentScene().run(),this.currentScene().updateDisplay(),this.runPlaySound(),this.before_keyflag=this.keyflag,this.frame_count++,requestAnimationFrame(this.run.bind(this))},notifyLoadingDone:function(){this.changeScene(n.DEBUG&&r?r:n.TITLE_SCENE)},notifyTitleDone:function(){this.changeScene(n.PROLOGUE1_SCENE)},notifyPrologue1Done:function(){this.changeScene(n.PROLOGUE2_SCENE)},notifyPrologue2Done:function(){this.changeScene(n.STAGE_SCENE)}},e.exports=c},{"./config":1,"./constant":2,"./scene/loading":16,"./scene/prologue1":17,"./scene/prologue2":18,"./scene/stage":19,"./scene/title":25}],5:[function(t,e,i){"use strict";var r=function(t){this.enemy_index=0,this.appear_params=t};r.prototype.get=function(t){for(var e=[];this.appear_params[this.enemy_index]&&this.appear_params[this.enemy_index].appear_frame===t;)e.push(this.appear_params[this.enemy_index]),this.enemy_index++;return e},e.exports=r},{}],6:[function(t,e,i){"use strict";var r=function(t,e){this.Class=t,this.stage=e,this.pool=[]};r.prototype.get=function(){var t=new this.Class(this.stage);return t.init.apply(t,arguments),t},r.prototype.free=function(t){},e.exports=r},{}],7:[function(t,e,i){"use strict";var r=t("./factory"),o=function(t,e){this.stage=e,this.factory=new r(t,e),this.objects={},this.frame_count=0};o.prototype.init=function(){this.objects={},this.frame_count=0},o.prototype.create=function(){var t=this.factory.get.apply(this.factory,arguments);return this.objects[t.id]=t,t},o.prototype.remove=function(t){delete this.objects[t],this.factory.free(t)},o.prototype.run=function(){this.frame_count++;for(var t in this.objects)this.objects[t].run();this.removeOutOfStageObjects()},o.prototype.removeOutOfStageObjects=function(){for(var t in this.objects)this.objects[t].isOutOfStage()&&this.remove(t)},o.prototype.updateDisplay=function(){for(var t in this.objects)this.objects[t].updateDisplay()},e.exports=o},{"./factory":6}],8:[function(t,e,i){"use strict";var r=t("../config"),o=function(t){this.timeoutID=null,this.script=t,this.progress=null,this.left_chara_id=null,this.left_exp=null,this.right_chara_id=null,this.right_exp=null,this.pos=null,this.fukidashi=null,this.line_num=0,this.printing_lines=[]};o.prototype.init=function(){this.progress=-1,this.timeoutID=null,this.left_chara_id=null,this.left_exp=null,this.right_chara_id=null,this.right_exp=null,this.pos=null,this.fukidashi=null,this.line_num=0,this.printing_lines=[],this.next()},o.prototype.is_end=function(){return this.progress+1===this.script.length},o.prototype.next=function(){this.progress++,r.DEBUG&&(this.script=JSON.parse(document.getElementById("prologue2").value));var t=this.script[this.progress];this._showChara(t),t.serif?this._printMessage(t.serif):this.next()},o.prototype._showChara=function(t){t.pos&&(this.pos=t.pos,this.fukidashi=t.fukidashi,"left"===t.pos?(this.left_chara_id=t.chara,this.left_exp=t.exp):"right"===t.pos&&(this.right_chara_id=t.chara,this.right_exp=t.exp))},o.prototype._printMessage=function(t){var e=this;null!==e.timeoutID&&(clearTimeout(e.timeoutID),e.timeoutID=null);var i=t.split(""),o=i.length,n=0;e.line_num=0,e.printing_lines=[];var a=function(){if(!(n>=o)){var t=r.MESSAGE_SPEED,s=i[n];n++,"\n"===s?e.line_num++:(e.printing_lines[e.line_num]||(e.printing_lines[e.line_num]=""),e.printing_lines[e.line_num]=e.printing_lines[e.line_num]+s),e.timeoutID=setTimeout(a,t)}};a()},o.prototype.right_image=function(){return this.right_chara_id?this.right_chara_id+"_"+this.right_exp:null},o.prototype.left_image=function(){return this.left_chara_id?this.left_chara_id+"_"+this.left_exp:null},o.prototype.right_name=function(){return this.right_chara_id?"name_"+this.right_chara_id:null},o.prototype.left_name=function(){return this.left_chara_id?"name_"+this.left_chara_id:null},o.prototype.serif_window=function(){return this.fukidashi?"fukidashi_"+this.fukidashi:null},o.prototype.is_left_talking=function(){return"left"===this.pos?!0:!1},o.prototype.is_right_talking=function(){return"right"===this.pos?!0:!1},o.prototype.lines=function(){return this.printing_lines},e.exports=o},{"../config":1}],9:[function(t,e,i){"use strict";var r=t("./game");window.AudioContext=window.AudioContext||window.webkitAudioContext,window.onload=function(){var t=document.getElementById("mainCanvas"),e=new r(t);e.init(),window.onkeydown=function(t){e.handleKeyDown(t)},window.onkeyup=function(t){e.handleKeyUp(t)},document.fonts?document.fonts.addEventListener("loadingdone",function(){e.fontLoadingDone()}):e.fontLoadingDone(),e.run()},window.onerror=function(t,e,i,r,o){window.alert(t+"\n"+i+":"+r)}},{"./game":4}],10:[function(t,e,i){"use strict";var r=100,o=0,n=function(t){this.frame_count=0,this.stage=t,this.game=t.game,this.id=++o,this.x=0,this.y=0};n.prototype.init=function(){this.frame_count=0},n.prototype.notifyCollision=function(t){console.error("notifyCollision method must be overridden.")},n.prototype.collisionHeight=function(){console.error("collisionHeight method must be overridden.")},n.prototype.collisionWidth=function(){console.error("collisionWidth method must be overridden.")},n.prototype.spriteX=function(){console.error("spriteX method must be overridden.")},n.prototype.spriteY=function(){console.error("spriteY method must be overridden.")},n.prototype.spriteImage=function(){console.error("spriteImage method must be overridden.")},n.prototype.spriteWidth=function(){console.error("spriteWidth method must be overridden.")},n.prototype.spriteHeight=function(){console.error("spriteHeight method must be overridden.")},n.prototype.run=function(){this.frame_count++},n.prototype.updateDisplay=function(){var t=Math.round(this.x-this.spriteWidth()/2),e=Math.round(this.y-this.spriteHeight()/2),i=this.game.getImage(this.spriteImage());this.game.surface.save(),this.game.surface.drawImage(i,this.spriteWidth()*this.spriteX(),this.spriteHeight()*this.spriteY(),this.spriteWidth(),this.spriteHeight(),t,e,this.spriteWidth(),this.spriteHeight()),this.game.surface.restore()},n.prototype.checkCollision=function(t){return this.inCollisionArea(t.getCollisionLeftX(),t.getCollisionUpY())||this.inCollisionArea(t.getCollisionLeftX(),t.getCollisionBottomY())||this.inCollisionArea(t.getCollisionRightX(),t.getCollisionUpY())||this.inCollisionArea(t.getCollisionRightX(),t.getCollisionBottomY())||this.inCollisionArea(t.x,t.y)?!0:!1},n.prototype.getCollisionLeftX=function(){return this.x-this.collisionWidth()/2},n.prototype.getCollisionRightX=function(){return this.x+this.collisionWidth()/2},n.prototype.getCollisionUpY=function(){return this.y-this.collisionHeight()/2},n.prototype.getCollisionBottomY=function(){return this.y+this.collisionHeight()/2},n.prototype.inCollisionArea=function(t,e){return t>=this.getCollisionLeftX()&&t<=this.getCollisionRightX()&&e>=this.getCollisionUpY()&&e<=this.getCollisionBottomY()?!0:!1},n.prototype.isOutOfStage=function(){return this.x+r<0||this.y+r<0||this.x>this.stage.width+r||this.y>this.stage.height+r?!0:!1},e.exports=n},{}],11:[function(t,e,i){"use strict";var r=t("./base"),o=t("../util"),n=t("../constant"),a=4,s=3,h=6,u=5,p=100,c=3,l=function(t){r.apply(this,arguments),this.indexX=0,this.indexY=0};o.inherit(l,r),l.prototype.setInitPosition=function(){this.x=this.stage.width/2,this.y=this.stage.height-100},l.prototype.init=function(){r.prototype.init.apply(this,arguments),this.setInitPosition(),this.life=c,this.is_unhittable=!0,this.unhittable_count=0},l.prototype.run=function(){r.prototype.run.apply(this,arguments),this.game.isKeyDown(n.BUTTON_Z)&&this.frame_count%u===0&&this.stage.shot_manager.create(this.x,this.y);var t=this.game.isKeyDown(n.BUTTON_Z)?s:a;this.game.isKeyDown(n.BUTTON_LEFT)&&(this.x-=t),this.game.isKeyDown(n.BUTTON_RIGHT)&&(this.x+=t),this.game.isKeyDown(n.BUTTON_DOWN)&&(this.y+=t),this.game.isKeyDown(n.BUTTON_UP)&&(this.y-=t),this.x<0&&(this.x=0),this.x>this.stage.width&&(this.x=this.stage.width),this.y<0&&(this.y=0),this.y>this.stage.height&&(this.y=this.stage.height),this.game.isKeyDown(n.BUTTON_LEFT)&&!this.game.isKeyDown(n.BUTTON_RIGHT)?this.indexY=1:this.game.isKeyDown(n.BUTTON_RIGHT)&&!this.game.isKeyDown(n.BUTTON_LEFT)?this.indexY=2:this.indexY=0,this.is_unhittable&&this.unhittable_count+p<this.frame_count&&(this.is_unhittable=!1),this.frame_count%h===0&&(this.indexX++,0===this.indexY&&this.indexX>2?this.indexX=0:(1===this.indexY||2===this.indexY)&&this.indexX>2&&(this.indexX=0))},l.prototype.updateDisplay=function(){this.is_unhittable&&(this.game.surface.globalAlpha=.7),r.prototype.updateDisplay.apply(this,arguments),this.is_unhittable&&(this.game.surface.globalAlpha=1)},l.prototype.collisionWidth=function(){return 4},l.prototype.collisionHeight=function(){return 4},l.prototype.spriteX=function(){return this.indexX},l.prototype.spriteY=function(){return this.indexY},l.prototype.spriteImage=function(){return"character_renko"},l.prototype.spriteWidth=function(){return 48},l.prototype.spriteHeight=function(){return 48},e.exports=l},{"../constant":2,"../util":28,"./base":10}],12:[function(t,e,i){"use strict";var r=t("./vector_base"),o=t("../util"),n=(t("../constant"),5),a=function(t){r.apply(this,arguments),this.indexX=0,this.indexY=0};o.inherit(a,r),a.prototype.init=function(t){r.prototype.init.apply(this,[t.vector]),this.x=t.x||0,this.y=t.y||0,this.vital=t.vital,this.powerItem=t.powerItem,this.scoreItem=t.scoreItem,this.shots=t.shot,this.shotCountIndex=0},a.prototype.run=function(){r.prototype.run.apply(this,arguments),this.frame_count%n===0&&(this.indexX++,this.indexX>2&&(this.indexX=0))},a.prototype.collisionWidth=function(){return this.spriteWidth()},a.prototype.collisionHeight=function(){return this.spriteHeight()},a.prototype.spriteX=function(){return this.indexX},a.prototype.spriteY=function(){return this.indexY},a.prototype.spriteImage=function(){return"enemy"},a.prototype.spriteWidth=function(){return 32},a.prototype.spriteHeight=function(){return 32},e.exports=a},{"../constant":2,"../util":28,"./vector_base":14}],13:[function(t,e,i){"use strict";var r=t("./base"),o=t("../util"),n=(t("../constant"),8),a=function(t){r.apply(this,arguments)};o.inherit(a,r),a.prototype.init=function(t,e){r.prototype.init.apply(this,arguments),this.x=t,this.y=e},a.prototype.run=function(){r.prototype.run.apply(this,arguments),this.y-=n},a.prototype.collisionWidth=function(){return this.spriteWidth()},a.prototype.collisionHeight=function(){return this.spriteHeight()},a.prototype.spriteX=function(){return 0},a.prototype.spriteY=function(){return 2},a.prototype.spriteImage=function(){return"shot"},a.prototype.spriteWidth=function(){return 20},a.prototype.spriteHeight=function(){return 20},e.exports=a},{"../constant":2,"../util":28,"./base":10}],14:[function(t,e,i){"use strict";var r=t("./base"),o=t("../util"),n=(t("../constant"),function(t,e){r.apply(this,arguments)});o.inherit(n,r),n.prototype.init=function(t){r.prototype.init.apply(this,arguments),this.vectors=[],this.vector_index=0;for(var e,i=0,o=t.length;o>i;i++)e=t[i],this.vectors.push({count:e.count,r:e.vector.r,theta:e.vector.theta||0,w:e.vector.w||0,ra:e.vector.ra||0,wa:e.vector.wa||0,raa:e.vector.raa||0,waa:e.vector.waa||0,trange:e.vector.trange||null,rrange:e.vector.rrange||null,wrange:e.vector.wrange||null,rarange:e.vector.rarange||null,warange:e.vector.warange||null,aimed:e.aimed});this._calculateAimedVector()},n.prototype._calculateAimedVector=function(){for(var t=0,e=this.vectors;e>t;t++)if(this.vectors[t].aimed){var i=this.stage.character,r=i.x-this.x,o=i.y-this.y;this.vectors[t].theta=this._radian_to_theta(Math.atan2(o,r))}},n.prototype.run=function(){if(r.prototype.run.apply(this,arguments),this.vectors[this.vector_index+1]&&this.vectors[this.vector_index+1].count<=this.frame_count){var t=this.vectors[this.vector_index].theta;this.vector_index++,t&&!this.vectors[this.vector_index].theta&&(this.vectors[this.vector_index].theta=t)}this.x+=this.calc_moveX(),this.y+=this.calc_moveY();var e=this.vectors[this.vector_index];e.theta+=e.w,e.r+=e.ra,e.w+=e.wa,e.ra+=e.raa,e.wa+=e.waa,e.theta=this._beInRange(e.theta,e.trange),e.r=this._beInRange(e.r,e.rrange),e.w=this._beInRange(e.w,e.wrange),e.ra=this._beInRange(e.ra,e.rarange),e.wa=this._beInRange(e.wa,e.warange)},n.prototype._beInRange=function(t,e){return null===e?t:(void 0!==e.max&&t>e.max&&(t=e.max),void 0!==e.min&&t<e.min&&(t=e.min),t)},n.prototype._theta_to_radian=function(t){return t/180*Math.PI},n.prototype._radian_to_theta=function(t){return 180*t/Math.PI|0},n.prototype.calc_moveX=function(){var t=this.vectors[this.vector_index],e=t.r*Math.cos(this._theta_to_radian(t.theta));return e},n.prototype.calc_moveY=function(){var t=this.vectors[this.vector_index],e=t.r*Math.sin(this._theta_to_radian(t.theta));return e},e.exports=n},{"../constant":2,"../util":28,"./base":10}],15:[function(t,e,i){"use strict";var r=function(t){this.game=t,this.frame_count=0};r.prototype.init=function(){this.frame_count=0},r.prototype.run=function(){this.frame_count++},r.prototype.updateDisplay=function(){console.error("updateDisplay method must be overridden")},e.exports=r},{}],16:[function(t,e,i){"use strict";var r=t("../util"),o=t("../config"),n=t("./base"),a=function(t){n.apply(this,arguments),this.loadedImageNum=0,this.loadedSoundNum=0,this.loadedBGMNum=0,this.fontLoadingDone=!1};r.inherit(a,n),a.prototype.init=function(){this._loadImages(),this._loadSounds(),this._loadBGMs()},a.prototype.loaded_material_num=function(){return this.loadedImageNum+this.loadedSoundNum+this.loadedBGMNum},a.prototype.notifyFontLoadingDone=function(){this.fontLoadingDone=!0},a.prototype.run=function(){this.loaded_material_num()>=o.ALL_MATERIAL_NUM&&this.fontLoadingDone&&this.game.notifyLoadingDone()},a.prototype.updateDisplay=function(){this.game.clearCanvas();var t=o.ALL_MATERIAL_NUM,e=this.loaded_material_num(),i=this.game.surface;i.save(),i.fillStyle="rgb( 0, 0, 0 )",i.textAlign="right",i.font="30px 'Migu'",i.fillText("Now Loading...",400,225),i.fillText(e+"/"+t,400,285),i.restore()},a.prototype._loadImages=function(){var t,e=this,i=function(){e.loadedImageNum++};for(var r in o.IMAGES)t=new Image,t.src=o.IMAGES[r],t.onload=i,this.game.images[r]=t},a.prototype._loadSounds=function(){var t,e,i=this,r=function(){i.loadedBGMNum++};for(var n in o.SOUNDS)t=o.SOUNDS[n],e=new Audio(t.path),e.volume=t.volume,e.addEventListener("canplay",r),e.load(),this.game.sounds[n]=e},a.prototype._loadBGMs=function(){var t=this;for(var e in o.BGMS)!function(e){var i=o.BGMS[e];i.path;t._loadBGM(i.path,function(i){t.loadedBGMNum++,t.game.bgms[e]=i})}(e)},a.prototype._loadBGM=function(t,e,i){var r=this,o=new XMLHttpRequest;o.onload=function(){if(200===o.status){var t=o.response;r.game.context.decodeAudioData(t,e,function(t){t instanceof Error?window.alert(t.message):window.alert('Error : "decodeAudioData" method.')})}},o.open("GET",t,!0),o.responseType="arraybuffer",o.send(null)},e.exports=a},{"../config":1,"../util":28,"./base":15}],17:[function(t,e,i){"use strict";var r=t("../serif/prologue1"),o=300,n=20,a=50,s=24,h=6,u=t("./base"),p=t("../util"),c=t("../constant"),l=t("../config"),g=function(t){u.apply(this,arguments)};p.inherit(g,u),g.prototype.init=function(){u.prototype.init.apply(this,arguments)},g.prototype.run=function(){u.prototype.run.apply(this,arguments),(o<this.frame_count||this.game.isKeyPush(c.BUTTON_Z))&&this.game.notifyPrologue1Done()},g.prototype.updateDisplay=function(){this.game.clearCanvas();this.game.surface;this._showBG(),this._showMessageWindow(),this._showMessage()},g.prototype._showBG=function(){var t=this.game.surface,e=this.game.getImage("prologue1_1_bg");t.drawImage(e,0,0,e.width,e.height,0,0,this.game.width,this.game.height)},g.prototype._showMessageWindow=function(){var t=this.game.surface;t.save(),t.globalAlpha=.5,t.fillStyle="rgb( 0, 0, 0 )",t.fillRect(n,n,this.game.width-2*n,this.game.height-2*n),t.restore()},g.prototype._setTransition=function(){var t=this.game.surface,e=1;this.frame_count<o/3?e=3*this.frame_count/o:o/3<this.frame_count&&this.frame_count<2*o/3?e=1:2*o/3<this.frame_count&&(e=3*(o-this.frame_count)/o),t.globalAlpha=e},g.prototype._showMessage=function(){var t=this.game.surface;if(t.save(),this._setTransition(),o>this.frame_count){t.font=s+"px 'Migu'",t.textBaseAlign="middle",t.fillStyle="rgb( 255, 255, 255 )";var e=l.DEBUG?document.getElementById("prologue1").value.split("\n"):r.split("\n");if(e.length)for(var i=a,n=0,u=e.length;u>n;n++)t.fillText(e[n],a,i),i+=s+h}t.restore()},e.exports=g},{"../config":1,"../constant":2,"../serif/prologue1":26,"../util":28,"./base":15}],18:[function(t,e,i){"use strict";var r=.5,o=5,n=t("./base"),a=t("../util"),s=t("../constant"),h=t("../config"),u=t("../serif/prologue2"),p=t("../logic/serif"),c=function(t){n.apply(this,arguments),this.serif=new p(u)};a.inherit(c,n),c.prototype.init=function(){n.prototype.init.apply(this,arguments),this.serif.init(),this.game.playBGM("prologue")},c.prototype.run=function(){n.prototype.run.apply(this,arguments),this.game.isKeyPush(s.BUTTON_Z)&&(this.serif.is_end()?this.game.notifyPrologue2Done():this.serif.next())},c.prototype.updateDisplay=function(){this.game.clearCanvas();this.game.surface;this._showBG(),this.serif.right_image()&&this._showRightChara(),this.serif.right_name()&&this._showName(this.serif.right_name(),h.PROLOGUE2_RIGHT_NAME_WINDOW_X,h.PROLOGUE2_RIGHT_NAME_WINDOW_Y),this.serif.left_image()&&this._showLeftChara(),this.serif.left_name()&&this._showName(this.serif.left_name(),h.PROLOGUE2_LEFT_NAME_WINDOW_X,h.PROLOGUE2_LEFT_NAME_WINDOW_Y),this.serif.serif_window()&&this._showMessageWindow(),this._showMessage()},c.prototype._showBG=function(){var t=this.game.surface,e=this.game.getImage("prologue2_bg");t.save(),t.drawImage(e,0,0,e.width,e.height,0,0,this.game.width,this.game.height),t.restore()},c.prototype._showRightChara=function(){var t=this.game.surface;t.save();var e=h.PROLOGUE2_RIGHT_X,i=h.PROLOGUE2_RIGHT_Y;this.serif.is_right_talking()?(e-=o,i-=o):t.globalAlpha=.5;var n=this.game.getImage(this.serif.right_image());t.drawImage(n,e,i,n.width*r,n.height*r),t.restore()},c.prototype._showLeftChara=function(){var t=this.game.surface;t.save();var e=h.PROLOGUE2_LEFT_X,i=h.PROLOGUE2_LEFT_Y;this.serif.is_left_talking()?(e-=-o,i-=o):t.globalAlpha=.5;var n=this.game.getImage(this.serif.left_image());t.transform(-1,0,0,1,n.width*r,0),t.drawImage(n,-e,i,n.width*r,n.height*r),t.restore()},c.prototype._showName=function(t,e,i){var o=this.game.surface;o.save();var n=this.game.getImage(t);o.drawImage(n,e,i,n.width*r,n.height*r),o.restore()},c.prototype._showMessageWindow=function(){var t=this.game.surface;t.save();var e=h.PROLOGUE2_SERIF_WINDOW_X,i=h.PROLOGUE2_SERIF_WINDOW_Y,o=this.game.getImage(this.serif.serif_window());this.serif.is_right_talking()&&(e=-e,t.transform(-1,0,0,1,o.width*r,0)),t.drawImage(o,e,i,o.width*r,o.height*r),t.restore()},c.prototype._showMessage=function(){var t=this.game.surface;t.save(),t.font="18px 'Migu'",t.textAlign="left",t.textBaseAlign="middle",t.fillStyle="rgb( 0, 0, 0 )";var e,i=this.serif.lines();if(i.length){e=80;for(var r=0,o=i.length;o>r;r++)t.fillText(i[r],200,e),e+=30}t.restore()},e.exports=c},{"../config":1,"../constant":2,"../logic/serif":8,"../serif/prologue2":27,"../util":28,"./base":15}],19:[function(t,e,i){"use strict";var r=160,o=2,n=t("./base"),a=t("../util"),s=t("../constant"),h=t("./stage/state/way"),u=t("./stage/state/talk"),p=t("./stage/state/boss"),c=t("./stage/state/result"),l=t("./stage/state/result"),g=t("../object/character"),f=t("../object/shot.js"),m=t("../object/enemy.js"),_=t("../logic/manager"),y=function(t){n.apply(this,arguments),this.state=null,this.states=[],this.states[s.WAY_STATE]=new h(this),this.states[s.TALK_STATE]=new u(this),this.states[s.BOSS_STATE]=new p(this),this.states[s.RESULT_STATE]=new c(this),this.states[s.GAMEOVER_STATE]=new l(this),this.width=this.game.width-r,this.height=this.game.height,this.character=new g(this),this.shot_manager=new _(f,this),this.enemy_manager=new _(m,this),this.objects=[this.shot_manager,this.character,this.enemy_manager]};a.inherit(y,n),y.prototype.init=function(){n.prototype.init.apply(this,arguments),this.state=null;for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].init();this.changeState(s.WAY_STATE)},y.prototype.currentState=function(){return this.states[this.state]},y.prototype.changeState=function(t){this.state=t,this.currentState().init()},y.prototype.run=function(){n.prototype.run.apply(this,arguments);for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].run();this.currentState().run()},y.prototype.updateDisplay=function(){this.game.clearCanvas(),this._showBG();for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].updateDisplay();this._showSidebar()},y.prototype._showSidebar=function(){var t=this.game.surface,e=this.game.width-r,i=0;t.save();var o=this.game.getImage("side_bar");this.game.surface.drawImage(o,0,0,o.width,o.height,e,i,r,this.game.height),t.restore(),this._showText()},y.prototype._showText=function(){var t=18,e=21,i=this.game.width-r+10,o=this.game.width-r+35,n=this.game.surface;n.save(),n.fillStyle="rgb( 255, 151, 151 )",n.textAlign="left",n.font=t+"px 'Migu'",n.fillText("HiScore",i,25),n.fillText("Score",i,70),n.fillText("Player",i,130),n.fillText("Spell",i,175),n.font=e+"px 'Migu'",n.fillText("123456789",o,50),n.fillText("123456789",o,95),n.fillText("★★★★★",o,155),n.fillText("★★★★★",o,200),n.restore()},y.prototype._showBG=function(){var t=this.game.surface,e=0,i=this.frame_count*o%this.game.height;t.save();var n=this.game.getImage("stage1_bg");this.game.surface.drawImage(n,0,0,n.width,n.height,e,i,this.game.width-r,this.game.height),this.game.surface.drawImage(n,0,0,n.width,n.height,e,i-this.game.height,this.game.width-r,this.game.height),
this.game.surface.restore()},e.exports=y},{"../constant":2,"../logic/manager":7,"../object/character":11,"../object/enemy.js":12,"../object/shot.js":13,"../util":28,"./base":15,"./stage/state/boss":21,"./stage/state/result":22,"./stage/state/talk":23,"./stage/state/way":24}],20:[function(t,e,i){"use strict";var r=function(t){this.stage=t,this.game=t.game,this.frame_count=0};r.prototype.init=function(){this.frame_count=0},r.prototype.run=function(){this.frame_count++},r.prototype.updateDisplay=function(){console.error("updateDisplay method must be overridden")},e.exports=r},{}],21:[function(t,e,i){"use strict";var r=function(t){this.game=t,this.frame_count=0};r.prototype.init=function(){this.frame_count=0},r.prototype.handleKeyDown=function(t){},r.prototype.handleKeyUp=function(t){},r.prototype.run=function(){this.frame_count++},r.prototype.updateDisplay=function(){console.error("updateDisplay method must be overridden")},e.exports=r},{}],22:[function(t,e,i){arguments[4][21][0].apply(i,arguments)},{dup:21}],23:[function(t,e,i){arguments[4][21][0].apply(i,arguments)},{dup:21}],24:[function(t,e,i){"use strict";var r=t("./base"),o=t("../../../util"),n=(t("../../../config"),t("../../../logic/enemy_appear")),a=t("../../../enemy/stage1"),s=function(t){r.apply(this,arguments),this.enemy_appear=new n(a)};o.inherit(s,r),s.prototype.init=function(){r.prototype.init.apply(this,arguments),this.game.stopBGM()},s.prototype.run=function(){r.prototype.run.apply(this,arguments),60===this.frame_count&&this.game.playBGM("douchu");for(var t=this.enemy_appear.get(this.frame_count),e=0,i=t.length;i>e;e++)this.stage.enemy_manager.create(t[e])},s.prototype.updateDisplay=function(){},e.exports=s},{"../../../config":1,"../../../enemy/stage1":3,"../../../logic/enemy_appear":5,"../../../util":28,"./base":20}],25:[function(t,e,i){"use strict";var r=t("./base"),o=t("../util"),n=t("../constant"),a=100,s=50,h=function(t){r.apply(this,arguments)};o.inherit(h,r),h.prototype.init=function(){r.prototype.init.apply(this,arguments)},h.prototype.run=function(){r.prototype.run.apply(this,arguments),this.game.isKeyPush(n.BUTTON_Z)&&(this.game.playSound("select"),this.game.notifyTitleDone())},h.prototype.updateDisplay=function(){this.game.clearCanvas();var t=this.game.surface;t.save(),this.frame_count<a?t.globalAlpha=this.frame_count/a:t.globalAlpha=1;var e=this.game.getImage("title_bg");t.drawImage(e,0,0,e.width,e.height,0,0,this.game.width,this.game.height),t.font="24px 'Migu'",t.textAlign="center",t.textBaseAlign="middle",t.fillStyle="rgb( 0, 0, 0 )",Math.floor(this.frame_count/s)%2===0&&t.fillText("Press Z to Start",450,350),t.restore()},e.exports=h},{"../constant":2,"../util":28,"./base":15}],26:[function(t,e,i){"use strict";var r=["蝉の鳴き声が聞こえる。","蓮子は湖のほとりにきている。","メリーと湖で涼もうと約束していた。","蓮子は珍しく先に到着した。","携帯情報端末を見ると、","8月31日の午前9時50分を回ったところ。","夜なら星を見れば時間がわかるのだけど。","約束まで、あと10分。","メリーの事だから早めに来るだろう、","と考えていた時に、背後から物音が聞こえる。","メリーだと思い振り向くと、","自分にそっくりな容姿の女の子が立っていた。"].join("\n");e.exports=r},{}],27:[function(t,e,i){"use strict";var r=[{serif:null,fukidashi:null,chara:"ganger",pos:"right",exp:"normal"},{serif:null,fukidashi:null,chara:"renko",pos:"left",exp:"normal"},{serif:"約束を守りなさい。\n早く博霊神社に行かないと。",fukidashi:"normal",chara:"ganger",pos:"right",exp:"normal"},{serif:"え、そんな約束してたっけ？",fukidashi:"normal",chara:"renko",pos:"left",exp:"normal"},{serif:null,fukidashi:null,chara:"merry",pos:"right",exp:"normal"},{serif:"どうしたの？",fukidashi:"normal",chara:"merry",pos:"right",exp:"normal"},{serif:"実はかくかくしかじかで",fukidashi:"normal",chara:"renko",pos:"left",exp:"normal"},{serif:"ふーん",fukidashi:"normal",chara:"merry",pos:"right",exp:"normal"},{serif:"約束といえば、前に博霊神社の\n入り口を調べようって\n約束してたわね。",fukidashi:"normal",chara:"renko",pos:"left",exp:"normal"},{serif:"そうだっけ？",fukidashi:"normal",chara:"merry",pos:"right",exp:"normal"},{serif:"なんだか気になるわ。\nねえ、今から行ってみない？",fukidashi:"normal",chara:"renko",pos:"left",exp:"normal"},{serif:"今から！？面倒だわ…。",fukidashi:"normal",chara:"merry",pos:"right",exp:"normal"},{serif:"そんな事言わずに\n行きましょうよ。",fukidashi:"normal",chara:"renko",pos:"left",exp:"normal"},{serif:"うっ…急にめまいと\nフラつきと腹痛と頭痛が",fukidashi:"normal",chara:"merry",pos:"right",exp:"normal"},{serif:"さっきまで\n元気だったじゃない！",fukidashi:"normal",chara:"renko",pos:"left",exp:"normal"},{serif:"うーん、気が進まないわ。",fukidashi:"normal",chara:"merry",pos:"right",exp:"normal"},{serif:"はぁ…。そんなに嫌なら\n仕方ないわね。\n私一人で行ってくるわ。",fukidashi:"normal",chara:"renko",pos:"left",exp:"normal"}];e.exports=r},{}],28:[function(t,e,i){"use strict";var r={inherit:function(t,e){var i=function(t){if(Object.create)return Object.create(t);var e=function(){};return e.prototype=t,new e};t.prototype=i(e.prototype),t.prototype.constructor=t}};e.exports=r},{}]},{},[9]);