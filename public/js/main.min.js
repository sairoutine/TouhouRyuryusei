!function t(e,i,s){function o(r,n){if(!i[r]){if(!e[r]){var h="function"==typeof require&&require;if(!n&&h)return h(r,!0);if(a)return a(r,!0);var p=new Error("Cannot find module '"+r+"'");throw p.code="MODULE_NOT_FOUND",p}var u=i[r]={exports:{}};e[r][0].call(u.exports,function(t){var i=e[r][1][t];return o(i?i:t)},u,u.exports,t,e,i,s)}return i[r].exports}for(var a="function"==typeof require&&require,r=0;r<s.length;r++)o(s[r]);return o}({1:[function(t,e,i){"use strict";var s=(t("./constant"),{DEBUG:!0,IMAGES:{title_bg:"image/title_bg.png",press_z:"image/press_z.png",prologue1_bg:"image/prologue1_bg.png",prologue2_bg:"image/prologue2_bg.png",logo:"image/logo.png",side_bar:"image/side_bar.png",fukidashi_normal:"image/fukidashi_blue.png",fukidashi_orange:"image/fukidashi_orange.png",fukidashi_purple:"image/fukidashi_purple.png",aya_normal:"image/aya_normal.png",aya_dissatisfied:"image/aya_dissatisfied.png",aya_smile:"image/aya_smile.png",ganger_normal:"image/ganger_normal.png",ganger_owata:"image/ganger_owata.png",hatena_normal:"image/ganger_normal.png",hatena_owata:"image/ganger_owata.png",renko_normal:"image/renko_normal.png",renko_disappointed:"image/renko_disappointed.png",renko_surprised:"image/renko_surprised.png",renko_trouble:"image/renko_trouble.png",renko_calm:"image/renko_calm.png",merry_normal:"image/merry_normal.png",merry_disappointed:"image/merry_disappointed.png",merry_trouble:"image/merry_trouble.png",name_aya:"image/name_aya.png",name_ganger:"image/name_ganger.png",name_hatena:"image/name_hatena.png",name_merry:"image/name_merry.png",name_renko:"image/name_renko.png",name_yuka:"image/name_yuka.png",name_sanae:"image/name_sanae.png",name_yukari:"image/name_yukari.png",stage1_bg:"image/stage1_bg.png",character_renko:"image/character_renko.png",boss_aya:"image/boss_aya.png",shot:"image/shot.png",item:"image/item.png",enemy:"image/enemy.png",epilogue1_bg:"image/epilogue1_bg.png",epilogue2_1_bg:"image/epilogue2_1_bg.jpg",epilogue2_2_bg:"image/epilogue2_2_bg.jpg"},SOUNDS:{select:{id:1,path:"sound/select.wav",volume:.8},boss_shot_small:{id:2,path:"sound/boss_shot_small.wav",volume:.15},boss_shot_big:{id:4,path:"sound/boss_shot_big.wav",volume:.15},spellcard:{id:8,path:"sound/spellcard.wav",volume:.15},dead:{id:16,path:"sound/dead.wav",volume:.08},enemy_vanish:{id:32,path:"sound/enemy_vanish.mp3",volume:.1},graze:{id:64,path:"sound/graze.wav",volume:.2}},BGMS:{title:{path:"bgm/title.mp3",volume:.6},prologue:{path:"bgm/prologue.ogg",volume:.4,loopStart:7.5,loopEnd:134.999},douchu:{path:"bgm/douchu.ogg",volume:.4,loopStart:99.096,loopEnd:198.193},stage1:{path:"bgm/stage1.ogg",volume:.5,loopStart:41.379,loopEnd:120.827},epilogue:{path:"bgm/epilogue.mp3",volume:1}},MESSAGE_SPEED:10,TALKER_MOVE_PX:5,CHARA_SIZE_RATIO:.5,PROLOGUE2_LEFT_X:0,PROLOGUE2_LEFT_Y:132,PROLOGUE2_RIGHT_X:283,PROLOGUE2_RIGHT_Y:132,PROLOGUE2_SERIF_WINDOW_X:80,PROLOGUE2_SERIF_WINDOW_Y:0,PROLOGUE2_LEFT_NAME_WINDOW_X:78,PROLOGUE2_LEFT_NAME_WINDOW_Y:420,PROLOGUE2_RIGHT_NAME_WINDOW_X:362,PROLOGUE2_RIGHT_NAME_WINDOW_Y:420,TALKING_LEFT_X:-59,TALKING_LEFT_Y:132,TALKING_RIGHT_X:182,TALKING_RIGHT_Y:132,TALKING_SERIF_WINDOW_X:0,TALKING_SERIF_WINDOW_Y:0,TALKING_LEFT_NAME_WINDOW_X:0,TALKING_LEFT_NAME_WINDOW_Y:420,TALKING_RIGHT_NAME_WINDOW_X:280,TALKING_RIGHT_NAME_WINDOW_Y:420});s.ALL_MATERIAL_NUM=Object.keys(s.IMAGES).length+Object.keys(s.SOUNDS).length+Object.keys(s.BGMS).length,e.exports=s},{"./constant":2}],2:[function(t,e,i){"use strict";var s={LOADING_SCENE:0,TITLE_SCENE:1,PROLOGUE1_SCENE:2,PROLOGUE2_SCENE:3,STAGE_SCENE:4,EPILOGUE1_SCENE:5,EPILOGUE2_SCENE:6,ENDING_SCENE:7,BUTTON_LEFT:1,BUTTON_UP:2,BUTTON_RIGHT:4,BUTTON_DOWN:8,BUTTON_Z:16,BUTTON_X:32,BUTTON_SHIFT:64,BUTTON_SPACE:128,WAY_STATE:0,TALK1_STATE:1,BOSS_STATE:2,TALK2_STATE:3,RESULT_STATE:4,GAMEOVER_STATE:5,SPELLCARD_START_STATE:0,SPELLCARD_EXEC_STATE:1};e.exports=s},{}],3:[function(t,e,i){"use strict";var s=[[{vector:{r:5,theta:165,w:0,ra:.1,wa:0,raa:-.01,rrange:{min:2}}},{vector:{r:5,theta:135,w:0,ra:.1,wa:0,raa:-.01,rrange:{min:2}}},{vector:{r:5,theta:105,w:0,ra:.1,wa:0,raa:-.01,rrange:{min:2}}},{vector:{r:5,theta:75,w:0,ra:.1,wa:0,raa:-.01,rrange:{min:2}}},{vector:{r:5,theta:45,w:0,ra:.1,wa:0,raa:-.01,rrange:{min:2}}},{vector:{r:5,theta:15,w:0,ra:.1,wa:0,raa:-.01,rrange:{min:2}}}],[{vector:{aimed:!0,r:5,theta:0,w:0,ra:.1,wa:0,raa:-.01,rrange:{min:3}}}]];e.exports=s},{}],4:[function(t,e,i){"use strict";var s=[{image:"shot",indexX:3,indexY:1,width:14,height:20,collisionWidth:13,collisionHeight:13,is_rotate:!0},{image:"shot",indexX:0,indexY:1,width:14,height:20,collisionWidth:13,collisionHeight:13,is_rotate:!0},{image:"shot",indexX:2,indexY:0,width:20,height:20,collisionWidth:16,collisionHeight:16,is_rotate:!1},{image:"shot",indexX:7,indexY:1,width:14,height:20,collisionWidth:13,collisionHeight:13,is_rotate:!0},{image:"shot",indexX:0,indexY:4,width:23,height:23,collisionWidth:13,collisionHeight:13,is_rotate:!1}];e.exports=s},{}],5:[function(t,e,i){"use strict";for(var s=[],o=0;6>o;o++)s.push({appear_frame:100+15*o,x:50+20*o,y:0,vital:1,powerItem:o%2===0?1:0,scoreItem:o%2===1?1:0,vector:[{count:0,vector:{r:2,theta:90,w:0,ra:0,wa:0}},{count:50,vector:{r:2,w:0,ra:0,wa:.01,trange:{max:135},wrange:{max:.5}}}]});for(var o=0;6>o;o++)s.push({appear_frame:300+15*o,x:380-20*o,y:0,vital:1,powerItem:o%2===0?1:0,scoreItem:o%2===1?1:0,vector:[{count:0,vector:{r:2,theta:90,w:0,ra:0,wa:0}},{count:50,vector:{r:2,w:0,ra:0,wa:-.01,trange:{min:45},wrange:{min:-.5}}}]});for(var o=0;6>o;o++)s.push({appear_frame:500+15*o,x:50+20*o,y:0,vital:1,powerItem:o%2===0?1:0,scoreItem:o%2===1?1:0,vector:[{count:0,vector:{r:2,theta:90,w:0,ra:0,wa:0}},{count:50,vector:{r:2,w:0,ra:0,wa:.01,trange:{max:135},wrange:{max:.5}}}]});for(var o=0;6>o;o++)s.push({appear_frame:700+15*o,x:380-20*o,y:0,vital:1,powerItem:o%2===0?1:0,vector:[{count:0,vector:{r:2,theta:90,w:0,ra:0,wa:0}},{count:50,vector:{r:2,w:0,ra:0,wa:-.01,trange:{min:45},wrange:{min:-.5}}}]});for(var o=0;8>o;o++)s.push({appear_frame:900+o*(80-5*o),x:25+o%4*50,y:0,vital:3,powerItem:o%2===0?1:0,shot:[{bullet:0,count:40+o%2*20}],vector:[{count:0,vector:{r:2,theta:90,w:0,ra:0,wa:0}},{count:30+o%2*20,vector:{r:0,theta:90,w:0,ra:0,wa:0}},{count:130+o%2*20,vector:{r:2,theta:90,w:0,ra:0,wa:.1,trange:{max:190}}}]});for(var o=0;8>o;o++)s.push({appear_frame:950+o*(80-5*o),x:455-o%4*50,y:0,vital:3,powerItem:o%2===0?1:0,shot:[{bullet:0,count:40+o%2*20}],vector:[{count:0,vector:{r:2,theta:90,w:0,ra:0,wa:0}},{count:30+o%2*20,vector:{r:0,theta:90,w:0,ra:0,wa:0}},{count:130+o%2*20,vector:{r:2,theta:90,w:0,ra:0,wa:-.1,trange:{min:-10}}}]});for(var o=0;4>o;o++)s.push({appear_frame:1400+20*o,x:50+50*o,y:0,vital:1,powerItem:o%4===0?1:0,scoreItem:o%4===2?1:0,shot:[{bullet:1,count:40}],vector:[{count:0,vector:{r:2,theta:90,w:0,ra:0,wa:0}},{count:30,vector:{r:2,w:0,ra:0,wa:-.01,trange:{min:-30},wrange:{min:-1}}}]});for(var o=0;4>o;o++)s.push({appear_frame:1410+10*o,x:25+50*o,y:0,vital:1,powerItem:o%4===0?1:0,scoreItem:o%4===2?1:0,shot:[{bullet:1,count:40}],vector:[{count:0,vector:{r:2,theta:90,w:0,ra:0,wa:0}},{count:30,vector:{r:2,w:0,ra:0,wa:-.01,trange:{min:-30},wrange:{min:-1}}}]});for(var o=0;4>o;o++)s.push({appear_frame:1420+20*o,x:430-50*o,y:0,vital:1,powerItem:o%4===0?1:0,scoreItem:o%4===2?1:0,shot:[{bullet:1,count:40}],vector:[{count:0,vector:{r:2,theta:90,w:0,ra:0,wa:0}},{count:30,vector:{r:2,w:0,ra:0,wa:.01,trange:{max:210},wrange:{max:1}}}]});for(var o=0;4>o;o++)s.push({appear_frame:1430+10*o,x:455-50*o,y:0,vital:1,powerItem:o%4===0?1:0,scoreItem:o%4===2?1:0,shot:[{bullet:1,count:40}],vector:[{count:0,vector:{r:2,theta:90,w:0,ra:0,wa:0}},{count:30,vector:{r:2,w:0,ra:0,wa:.01,trange:{max:210},wrange:{max:1}}}]});for(var o=0;20>o;o++)s.push({appear_frame:1700+10*parseInt(o/2),x:(o%2===0?50:80)+10*o,y:0,vital:1,powerItem:o%4===0?1:0,scoreItem:o%4===2?1:0,vector:[{count:0,vector:{r:3,theta:90,w:0,ra:0,wa:0}},{count:30,vector:{r:3,w:0,ra:0,wa:-.02,trange:{min:-45},wrange:{min:-1}}},{count:180,vector:{r:3,w:0,ra:0,wa:.02,trange:{max:45},wrange:{max:1}}}]});for(var o=0;20>o;o++)s.push({appear_frame:1900+10*parseInt(o/2),x:(o%2===0?430:400)-10*o,y:0,vital:1,powerItem:o%4===0?1:0,scoreItem:o%4===2?1:0,vector:[{count:0,vector:{r:3,theta:90,w:0,ra:0,wa:0}},{count:30,vector:{r:3,w:0,ra:0,wa:.02,trange:{max:225},wrange:{max:1}}},{count:180,vector:{r:3,w:0,ra:0,wa:-.02,trange:{min:135},wrange:{min:-1}}}]});for(var o=0;8>o;o++)s.push({appear_frame:2300+o*(80-5*o),x:25+o%4*50,y:0,vital:3,powerItem:o%2===0?1:0,scoreItem:o%2===1?1:0,shot:[{bullet:0,count:40+o%2*20}],vector:[{count:0,vector:{r:2,theta:90,w:0,ra:0,wa:0}},{count:30+o%2*20,vector:{r:0,theta:90,w:0,ra:0,wa:0}},{count:130+o%2*20,vector:{r:2,theta:90,w:0,ra:0,wa:.1,trange:{max:190}}}]});for(var o=0;8>o;o++)s.push({appear_frame:2350+o*(80-5*o),x:455-o%4*50,y:0,vital:3,powerItem:o%2===0?1:0,scoreItem:o%2===1?1:0,shot:[{bullet:0,count:40+o%2*20}],vector:[{count:0,vector:{r:2,theta:90,w:0,ra:0,wa:0}},{count:30+o%2*20,vector:{r:0,theta:90,w:0,ra:0,wa:0}},{count:130+o%2*20,vector:{r:2,theta:90,w:0,ra:0,wa:-.1,trange:{min:-10}}}]});for(var o=0;8>o;o++)s.push({appear_frame:2500+o*(80-5*o),x:25+o%4*50,y:0,vital:3,powerItem:o%2===0?1:0,scoreItem:o%2===1?1:0,shot:[{bullet:0,count:40+o%2*20}],vector:[{count:0,vector:{r:2,theta:90,w:0,ra:0,wa:0}},{count:30+o%2*20,vector:{r:0,theta:90,w:0,ra:0,wa:0}},{count:130+o%2*20,vector:{r:2,theta:90,w:0,ra:0,wa:.1,trange:{max:190}}}]});for(var o=0;8>o;o++)s.push({appear_frame:2550+o*(80-5*o),x:455-o%4*50,y:0,vital:3,powerItem:o%2===0?1:0,scoreItem:o%2===1?1:0,shot:[{bullet:0,count:40+o%2*20}],vector:[{count:0,vector:{r:2,theta:90,w:0,ra:0,wa:0}},{count:30+o%2*20,vector:{r:0,theta:90,w:0,ra:0,wa:0}},{count:130+o%2*20,vector:{r:2,theta:90,w:0,ra:0,wa:-.1,trange:{min:-10}}}]});for(var o=0;8>o;o++)s.push({appear_frame:2700+o*(80-5*o),x:25+o%4*50,y:0,vital:3,powerItem:o%2===0?1:0,scoreItem:o%2===1?1:0,shot:[{bullet:0,count:40+o%2*20}],vector:[{count:0,vector:{r:2,theta:90,w:0,ra:0,wa:0}},{count:30+o%2*20,vector:{r:0,theta:90,w:0,ra:0,wa:0}},{count:130+o%2*20,vector:{r:2,theta:90,w:0,ra:0,wa:.1,trange:{max:190}}}]});for(var o=0;8>o;o++)s.push({appear_frame:2750+o*(80-5*o),x:455-o%4*50,y:0,vital:3,powerItem:o%2===0?1:0,scoreItem:o%2===1?1:0,shot:[{bullet:0,count:40+o%2*20}],vector:[{count:0,vector:{r:2,theta:90,w:0,ra:0,wa:0}},{count:30+o%2*20,vector:{r:0,theta:90,w:0,ra:0,wa:0}},{count:130+o%2*20,vector:{r:2,theta:90,w:0,ra:0,wa:-.1,trange:{min:-10}}}]});s.sort(function(t,e){return t.appear_frame-e.appear_frame}),e.exports=s},{}],6:[function(t,e,i){"use strict";var s=t("./config"),o=t("./constant"),a=t("./scene/loading"),r=t("./scene/title"),n=t("./scene/prologue1"),h=t("./scene/prologue2"),p=t("./scene/stage"),u=t("./scene/epilogue1"),c=t("./scene/epilogue2"),l=t("./scene/ending"),g=function(t){this.surface=t.getContext("2d"),this.width=Number(t.getAttribute("width")),this.height=Number(t.getAttribute("height")),this.audio_context=new window.AudioContext,this.audio_context.createGain=this.audio_context.createGain||this.audio_context.createGainNode,this.audio_gain=this.audio_context.createGain(),this.audio_source=null,this.state=null,this.scenes=[],this.scenes[o.LOADING_SCENE]=new a(this),this.scenes[o.TITLE_SCENE]=new r(this),this.scenes[o.PROLOGUE1_SCENE]=new n(this),this.scenes[o.PROLOGUE2_SCENE]=new h(this),this.scenes[o.STAGE_SCENE]=new p(this),this.scenes[o.EPILOGUE1_SCENE]=new u(this),this.scenes[o.EPILOGUE2_SCENE]=new c(this),this.scenes[o.ENDING_SCENE]=new l(this),this.images={},this.sounds={},this.bgms={},this.soundflag=0,this.frame_count=0,this.keyflag=0,this.before_keyflag=0,this.is_connect_gamepad=0};g.prototype={init:function(){this.frame_count=0,this.keyflag=0,this.before_keyflag=0,this.is_connect_gamepad=0,this.changeScene(o.LOADING_SCENE)},fontLoadingDone:function(){this.state===o.LOADING_SCENE&&this.currentScene().notifyFontLoadingDone()},handleKeyDown:function(t){this.keyflag|=this._keyCodeToBitCode(t.keyCode),t.preventDefault()},handleKeyUp:function(t){this.keyflag&=~this._keyCodeToBitCode(t.keyCode),t.preventDefault()},isKeyDown:function(t){return this.keyflag&t},isKeyPush:function(t){return!(this.before_keyflag&t)&&this.keyflag&t},_keyCodeToBitCode:function(t){var e;switch(t){case 16:e=o.BUTTON_SHIFT;break;case 32:e=o.BUTTON_SPACE;break;case 37:e=o.BUTTON_LEFT;break;case 38:e=o.BUTTON_UP;break;case 39:e=o.BUTTON_RIGHT;break;case 40:e=o.BUTTON_DOWN;break;case 88:e=o.BUTTON_X;break;case 90:e=o.BUTTON_Z}return e},changeScene:function(t){null!==this.state&&this.currentScene().onunload(),this.state=t,this.currentScene().init()},playBGM:function(t){var e=this;s.DEBUG_MUSIC_OFF||(e.stopBGM(),e.audio_source=e._createSourceNode(t),e.audio_source.start(0))},stopBGM:function(t){var e=this;e.audio_source&&e.audio_source.stop(0)},_createSourceNode:function(t){var e=this,i=e.bgms[t],o=s.BGMS[t],a=e.audio_context.createBufferSource();return a.buffer=i,a.loop=!0,o.loopStart&&(a.loopStart=o.loopStart),o.loopEnd&&(a.loopEnd=o.loopEnd),o.volume&&(e.audio_gain.gain.value=o.volume),a.connect(e.audio_gain),e.audio_gain.connect(e.audio_context.destination),a.start=a.start||a.noteOn,a.stop=a.stop||a.noteOff,a},playSound:function(t){this.soundflag|=s.SOUNDS[t].id},runPlaySound:function(){for(var t in s.SOUNDS)if(this.soundflag&s.SOUNDS[t].id){this.sounds[t].pause(),this.sounds[t].currentTime=0,this.sounds[t].play(),this.soundflag&=~s.SOUNDS[t].id;break}},getImage:function(t){return this.images[t]},currentScene:function(){return this.scenes[this.state]},clearCanvas:function(){this.surface.clearRect(0,0,this.width,this.height)},run:function(){this.handleGamePad(),this.currentScene().run(),this.currentScene().updateDisplay(),this.runPlaySound(),this.before_keyflag=this.keyflag,this.frame_count++,requestAnimationFrame(this.run.bind(this))},notifyLoadingDone:function(){this.changeScene(s.DEBUG&&s.DEBUG_SCENE?s.DEBUG_SCENE:o.TITLE_SCENE)},notifyTitleDone:function(){var t=document.getElementById("scene").value;this.changeScene(s.DEBUG&&t?t:o.PROLOGUE1_SCENE)},notifyPrologue1Done:function(){this.changeScene(o.PROLOGUE2_SCENE)},notifyPrologue2Done:function(){this.changeScene(o.STAGE_SCENE)},notifyStageDone:function(){this.changeScene(o.EPILOGUE1_SCENE)},notifyEpilogue1Done:function(){this.changeScene(o.EPILOGUE2_SCENE)},notifyEpilogue2Done:function(){this.changeScene(o.ENDING_SCENE)},notifyGameOver:function(){this.changeScene(o.TITLE_SCENE)},handleGamePad:function(){if(this.is_connect_gamepad){var t=navigator.getGamepads(),e=t[0];e&&(this.keyflag=0,this.keyflag|=e.buttons[1].pressed?o.BUTTON_Z:0,this.keyflag|=e.buttons[0].pressed?o.BUTTON_X:0,this.keyflag|=e.buttons[2].pressed?o.BUTTON_SELECT:0,this.keyflag|=e.buttons[3].pressed?o.BUTTON_START:0,this.keyflag|=e.axes[1]<-.5?o.BUTTON_UP:0,this.keyflag|=e.axes[1]>.5?o.BUTTON_DOWN:0,this.keyflag|=e.axes[0]<-.5?o.BUTTON_LEFT:0,this.keyflag|=e.axes[0]>.5?o.BUTTON_RIGHT:0)}},enableGamePad:function(){this.is_connect_gamepad=1}},e.exports=g},{"./config":1,"./constant":2,"./scene/ending":22,"./scene/epilogue1":23,"./scene/epilogue2":24,"./scene/loading":25,"./scene/prologue1":26,"./scene/prologue2":27,"./scene/stage":28,"./scene/title":34}],7:[function(t,e,i){"use strict";var s=function(t){this.enemy_index=0,this.appear_params=t};s.prototype.init=function(){this.enemy_index=0},s.prototype.get=function(t){for(var e=[];this.appear_params[this.enemy_index]&&this.appear_params[this.enemy_index].appear_frame===t;)e.push(this.appear_params[this.enemy_index]),this.enemy_index++;return e},e.exports=s},{}],8:[function(t,e,i){"use strict";var s=function(t,e){this.Class=t,this.stage=e,this.pool=[]};s.prototype.get=function(){var t=new this.Class(this.stage);return t.init.apply(t,arguments),t},s.prototype.free=function(t){},e.exports=s},{}],9:[function(t,e,i){"use strict";var s=t("./factory"),o=function(t,e){this.stage=e,this.factory=new s(t,e),this.objects={},this.frame_count=0};o.prototype.init=function(){this.objects={},this.frame_count=0},o.prototype.create=function(){var t=this.factory.get.apply(this.factory,arguments);return this.objects[t.id]=t,t},o.prototype.remove=function(t){delete this.objects[t],this.factory.free(t)},o.prototype.run=function(){this.frame_count++;for(var t in this.objects)this.objects[t].run();this.removeOutOfStageObjects()},o.prototype.removeOutOfStageObjects=function(){for(var t in this.objects)this.objects[t].isOutOfStage()&&this.remove(t)},o.prototype.updateDisplay=function(){for(var t in this.objects)this.objects[t].updateDisplay()},o.prototype.checkCollisionWithObject=function(t){for(var e in this.objects){var i=this.objects[e];if(t.checkCollision(i)){t.notifyCollision(i),i.notifyCollision(t);break}}},o.prototype.checkCollisionWithManager=function(t){t:for(var e in this.objects)for(var i in t.objects)if(this.objects[e].checkCollision(t.objects[i])){var s=this.objects[e],o=t.objects[i];s.notifyCollision(o),o.notifyCollision(s);break t}},o.prototype.notifyUseBomb=function(){for(var t in this.objects)this.objects[t].notifyUseBomb()},o.prototype.checkGrazeWithObject=function(t){for(var e in this.objects){var i=this.objects[e];if(t.checkGraze(i)){t.notifyGraze(i),i.notifyGraze(t);break}}},e.exports=o},{"./factory":8}],10:[function(t,e,i){"use strict";var s=t("../config"),o=function(t){this.timeoutID=null,this.script=t,this.progress=null,this.left_chara_id=null,this.left_exp=null,this.right_chara_id=null,this.right_exp=null,this.pos=null,this.fukidashi=null,this.line_num=0,this.printing_lines=[]};o.prototype.init=function(){this.progress=-1,this.timeoutID=null,this.left_chara_id=null,this.left_exp=null,this.right_chara_id=null,this.right_exp=null,this.pos=null,this.fukidashi=null,this.line_num=0,this.printing_lines=[],this.next()},o.prototype.is_end=function(){return this.progress+1===this.script.length},o.prototype.next=function(){this.progress++;var t=this.script[this.progress];this._showChara(t),t.serif?this._printMessage(t.serif):this.next()},o.prototype._showChara=function(t){t.pos&&(this.pos=t.pos,this.fukidashi=t.fukidashi,"left"===t.pos?(this.left_chara_id=t.chara,this.left_exp=t.exp):"right"===t.pos&&(this.right_chara_id=t.chara,this.right_exp=t.exp))},o.prototype._printMessage=function(t){var e=this;null!==e.timeoutID&&(clearTimeout(e.timeoutID),e.timeoutID=null);var i=t.split(""),o=i.length,a=0;e.line_num=0,e.printing_lines=[];var r=function(){if(!(a>=o)){var t=s.MESSAGE_SPEED,n=i[a];a++,"\n"===n?e.line_num++:(e.printing_lines[e.line_num]||(e.printing_lines[e.line_num]=""),e.printing_lines[e.line_num]=e.printing_lines[e.line_num]+n),e.timeoutID=setTimeout(r,t)}};r()},o.prototype.right_image=function(){return this.right_chara_id?this.right_chara_id+"_"+this.right_exp:null},o.prototype.left_image=function(){return this.left_chara_id?this.left_chara_id+"_"+this.left_exp:null},o.prototype.right_name=function(){return this.right_chara_id?"name_"+this.right_chara_id:null},o.prototype.left_name=function(){return this.left_chara_id?"name_"+this.left_chara_id:null},o.prototype.serif_window=function(){return this.fukidashi?"fukidashi_"+this.fukidashi:null},o.prototype.is_left_talking=function(){return"left"===this.pos?!0:!1},o.prototype.is_right_talking=function(){return"right"===this.pos?!0:!1},o.prototype.lines=function(){return this.printing_lines},e.exports=o},{"../config":1}],11:[function(t,e,i){"use strict";var s=t("./game");window.AudioContext=window.AudioContext||window.webkitAudioContext,window.onload=function(){var t=document.getElementById("mainCanvas"),e=new s(t);e.init(),window.onkeydown=function(t){e.handleKeyDown(t)},window.onkeyup=function(t){e.handleKeyUp(t)},document.fonts?document.fonts.addEventListener("loadingdone",function(){e.fontLoadingDone()}):e.fontLoadingDone(),window.Gamepad&&navigator.getGamepads&&e.enableGamePad(),e.run()},window.onerror=function(t,e,i,s,o){window.alert(t+"\n"+i+":"+s)}},{"./game":6}],12:[function(t,e,i){"use strict";var s=t("./base"),o=t("../util"),a=(t("../constant"),t("../spell/stage1/tengukaze")),r=t("../spell/stage1/konohamai"),n=t("../object/shot"),h=6,p=4,u=3600,c=2,l=function(t){s.apply(this,arguments),this.indexX=0,this.indexY=0,this.spell_index=0,this.spells=[null,new a(this),new r(this)]};o.inherit(l,s),l.prototype.setInitPosition=function(){this.x=this.stage.width/2,this.y=this.stage.height-400},l.prototype.init=function(){s.prototype.init.apply(this,arguments),this.setInitPosition(),this.max_vital=u,this.vital=u,this.spell_index=0,this.executeSpell()},l.prototype.currentSpell=function(){return this.spells[this.spell_index]},l.prototype.executeSpell=function(){this.spell_index++,this.currentSpell().init()},l.prototype.hasNextSpell=function(){return this.spells[this.spell_index+1]?!0:!1},l.prototype.resetVital=function(){this.vital=this.max_vital},l.prototype.isDead=function(){return this.vital<=0},l.prototype.run=function(){s.prototype.run.apply(this,arguments),this.currentSpell().run(),this.currentSpell().isSpellExecute()&&(this.vital--,this.stage.score+=10),this.isDead()&&this.hasNextSpell()&&(this.resetVital(),this.executeSpell());var t=0===this.indexY?h:p;this.frame_count%t===0&&(this.indexX++,this.indexX>2&&(this.indexX=0))},l.prototype.moveLeft=function(){this.x-=c},l.prototype.moveRight=function(){this.x+=c},l.prototype.moveUp=function(){this.y-=c},l.prototype.moveDown=function(){this.y+=c},l.prototype.moveByTheta=function(t){this.x+=this.calc_moveX(t),this.y+=this.calc_moveY(t)},l.prototype._theta_to_radian=function(t){return t/180*Math.PI},l.prototype.calc_moveX=function(t){var e=c*Math.cos(this._theta_to_radian(t));return e},l.prototype.calc_moveY=function(t){var e=c*Math.sin(this._theta_to_radian(t));return e},l.prototype.animateLeft=function(){this.indexY=1},l.prototype.animateRight=function(){this.indexY=2},l.prototype.animateNeutral=function(){this.indexY=0},l.prototype.updateDisplay=function(){s.prototype.updateDisplay.apply(this,arguments),this.currentSpell().updateDisplay()},l.prototype.notifyCollision=function(t){t instanceof n&&(this.vital--,this.stage.score+=10)},l.prototype.collisionWidth=function(){return 64},l.prototype.collisionHeight=function(){return 64},l.prototype.spriteX=function(){return this.indexX},l.prototype.spriteY=function(){return this.indexY},l.prototype.spriteImage=function(){return"boss_aya"},l.prototype.spriteWidth=function(){return 128},l.prototype.spriteHeight=function(){return 128},e.exports=l},{"../constant":2,"../object/shot":19,"../spell/stage1/konohamai":43,"../spell/stage1/tengukaze":44,"../util":45,"./base":13}],13:[function(t,e,i){"use strict";var s,o=t("../config"),a=100,r=0,n=function(t){this.frame_count=0,this.stage=t,this.game=t.game,this.id=++r,this.x=0,this.y=0,this.rotate=0};n.prototype.init=function(){this.frame_count=0},n.prototype.notifyCollision=function(t){console.error("notifyCollision method must be overridden.")},n.prototype.collisionHeight=function(){console.error("collisionHeight method must be overridden.")},n.prototype.collisionWidth=function(){console.error("collisionWidth method must be overridden.")},n.prototype.grazeHeight=function(){console.error("grazeHeight method must be overridden.")},n.prototype.grazeWidth=function(){console.error("grazeWidth method must be overridden.")},n.prototype.spriteX=function(){console.error("spriteX method must be overridden.")},n.prototype.spriteY=function(){console.error("spriteY method must be overridden.")},n.prototype.spriteImage=function(){console.error("spriteImage method must be overridden.")},n.prototype.spriteWidth=function(){console.error("spriteWidth method must be overridden.")},n.prototype.spriteHeight=function(){console.error("spriteHeight method must be overridden.")},n.prototype.run=function(){this.frame_count++},n.prototype.updateDisplay=function(){var t=this.game.surface,e=this.game.getImage(this.spriteImage());t.save(),t.translate(this.x,this.y),t.rotate(this.rotate),t.drawImage(e,this.spriteWidth()*this.spriteX(),this.spriteHeight()*this.spriteY(),this.spriteWidth(),this.spriteHeight(),-this.spriteWidth()/2,-this.spriteHeight()/2,this.spriteWidth(),this.spriteHeight()),t.restore(),o.DEBUG&&s&&(t.save(),t.fillStyle="rgb( 0, 0, 0 )",t.globalAlpha=.4,t.fillRect(this.getCollisionLeftX(),this.getCollisionUpY(),this.collisionWidth(),this.collisionHeight()),t.restore())},n.prototype.checkCollisionWithObject=function(t){var e=this;return t.checkCollision(e)?(t.notifyCollision(e),e.notifyCollision(t),!0):!1},n.prototype.checkCollision=function(t){return Math.abs(this.x-t.x)<this.collisionWidth()/2+t.collisionWidth()/2&&Math.abs(this.y-t.y)<this.collisionHeight()/2+t.collisionHeight()/2?!0:!1},n.prototype.getCollisionLeftX=function(){return this.x-this.collisionWidth()/2},n.prototype.getCollisionUpY=function(){return this.y-this.collisionHeight()/2},n.prototype.checkGraze=function(t){return Math.abs(this.x-t.x)<this.grazeWidth()/2+t.grazeWidth()/2&&Math.abs(this.y-t.y)<this.grazeHeight()/2+t.grazeHeight()/2?!0:!1},n.prototype.isOutOfStage=function(){return this.x+a<0||this.y+a<0||this.x>this.stage.width+a||this.y>this.stage.height+a?!0:!1},n.prototype.notifyUseBomb=function(){},n.prototype.notifyGraze=function(){},e.exports=n},{"../config":1}],14:[function(t,e,i){"use strict";var s=t("./vector_base"),o=t("../util"),a=(t("../constant"),t("../enemy/bullet_types")),r=function(t){s.apply(this,arguments)};o.inherit(r,s),r.prototype.init=function(t,e,i,o){this.x=e,this.y=i;var r=a[t];s.prototype.init.apply(this,[[{count:0,vector:o,is_rotate:r.is_rotate}]]),this.image=r.image,this.indexX=r.indexX,this.indexY=r.indexY,this.width=r.width,this.height=r.height,this.collision_width=r.collisionWidth,this.collision_height=r.collisionHeight,this.is_graze=!1},r.prototype.notifyCollision=function(t){this.stage.bullet_manager.remove(this.id)},r.prototype.notifyGraze=function(t){this.is_graze=!0},r.prototype.notifyUseBomb=function(){this.stage.bullet_manager.remove(this.id),this.stage.score+=100,this.stage.item_manager.create(0,this.x,this.y)},r.prototype.collisionWidth=function(){return this.collision_width},r.prototype.collisionHeight=function(){return this.collision_height},r.prototype.grazeHeight=function(){return this.width},r.prototype.grazeWidth=function(){return this.height},r.prototype.spriteX=function(){return this.indexX},r.prototype.spriteY=function(){return this.indexY},r.prototype.spriteImage=function(){return this.image},r.prototype.spriteWidth=function(){return this.width},r.prototype.spriteHeight=function(){return this.height},e.exports=r},{"../constant":2,"../enemy/bullet_types":4,"../util":45,"./vector_base":20}],15:[function(t,e,i){"use strict";var s=t("./base"),o=t("../util"),a=(t("../constant"),t("./aya")),r=t("./enemy"),n=t("./bullet"),h=t("../spell/renko/spell1"),p=4,u=3,c=6,l=4,g=5,f=100,_=500,m=5,y=5,d={r:8,theta:270},v=function(t){s.apply(this,arguments),this.indexX=0,this.indexY=0,this.spell=new h(this)};o.inherit(v,s),v.prototype.setInitPosition=function(){this.x=this.stage.width/2,this.y=this.stage.height-100},v.prototype.init=function(){s.prototype.init.apply(this,arguments),this.setInitPosition(),this.life=m,this.bombs=y,this.is_using_bomb=!1,this.using_bomb_count=0,this.is_unhittable=!0,this.unhittable_count=0},v.prototype.shot=function(){this.frame_count%g===0&&this.stage.shot_manager.create(0,this.x,this.y,d)},v.prototype.forbidOutOfStage=function(){this.x<0&&(this.x=0),this.x>this.stage.width&&(this.x=this.stage.width),this.y<0&&(this.y=0),this.y>this.stage.height&&(this.y=this.stage.height)},v.prototype.moveLeft=function(t){this.x-=t?u:p},v.prototype.moveRight=function(t){this.x+=t?u:p},v.prototype.moveUp=function(t){this.y-=t?u:p},v.prototype.moveDown=function(t){this.y+=t?u:p},v.prototype.animateLeft=function(){this.indexY=1},v.prototype.animateRight=function(){this.indexY=2},v.prototype.animateNeutral=function(){this.indexY=0},v.prototype.run=function(){s.prototype.run.apply(this,arguments),this.is_unhittable&&this.unhittable_count+f<this.frame_count&&(this.is_unhittable=!1),this.is_using_bomb&&this.using_bomb_count+_<this.frame_count&&(this.is_using_bomb=!1);var t=0===this.indexY?c:l;this.frame_count%t===0&&(this.indexX++,this.indexX>2&&(this.indexX=0)),this.is_using_bomb&&this.spell.run()},v.prototype.updateDisplay=function(){this.is_unhittable&&(this.game.surface.globalAlpha=.7),s.prototype.updateDisplay.apply(this,arguments),this.is_unhittable&&(this.game.surface.globalAlpha=1),this.is_using_bomb&&this.spell.updateDisplay()},v.prototype.checkCollision=function(t){return(t instanceof n||t instanceof r||t instanceof a)&&(this.is_unhittable||this.is_using_bomb)?!1:s.prototype.checkCollision.apply(this,arguments)},v.prototype.die=function(){this.setInitPosition(),this.life--,this.is_unhittable=!0,this.unhittable_count=this.frame_count},v.prototype.notifyCollision=function(t){(t instanceof n||t instanceof r||t instanceof a)&&(this.game.playSound("dead"),this.stage.effect_manager.create(this.x,this.y),this.die(),0===this.life&&this.stage.notifyCharacterDead())},v.prototype.useBomb=function(){this.bombs<=0||this.is_using_bomb||(this.bombs--,this.using_bomb_count=this.frame_count,this.is_using_bomb=!0,this.stage.enemy_manager.notifyUseBomb(),this.stage.bullet_manager.notifyUseBomb(),this.spell.init())},v.prototype.notifyGraze=function(t){t instanceof n&&(t.is_graze||(this.game.playSound("graze"),this.stage.score+=100))},v.prototype.collisionWidth=function(){return 1},v.prototype.collisionHeight=function(){return 3},v.prototype.grazeHeight=function(){return 48},v.prototype.grazeWidth=function(){return 48},v.prototype.spriteX=function(){return this.indexX},v.prototype.spriteY=function(){return this.indexY},v.prototype.spriteImage=function(){return"character_renko"},v.prototype.spriteWidth=function(){return 48},v.prototype.spriteHeight=function(){return 48},e.exports=v},{"../constant":2,"../spell/renko/spell1":41,"../util":45,"./aya":12,"./base":13,"./bullet":14,"./enemy":17}],16:[function(t,e,i){"use strict";var s=10,o=32,a=t("./base"),r=t("../util"),n=(t("../constant"),function(t,e){a.apply(this,arguments)});r.inherit(n,a),n.prototype.init=function(t,e){this.x=t,this.y=e},n.prototype.run=function(){a.prototype.run.apply(this,arguments),s<=this.frame_count&&this.stage.effect_manager.remove(this.id)},n.prototype.updateDisplay=function(){var t=this.x,e=this.y,i=Math.round(o*this.frame_count*.1),a=document.createElement("canvas");a.width=2*i+4,a.height=2*i+4;var r=a.getContext("2d");r.beginPath(),r.fillStyle="rgb(255, 255, 255)",r.globalAlpha=.05*(s-this.frame_count+1),r.arc(i+2,i+2,i,0,2*Math.PI),r.fill(),r.beginPath(),r.strokeStyle="rgb(255, 255, 255)",r.globalAlpha=.1*(s-this.frame_count+1),r.lineWidth=3,r.arc(i+2,i+2,i,0,2*Math.PI),r.stroke(),this.game.surface.drawImage(a,t-i-2,e-i-2)},e.exports=n},{"../constant":2,"../util":45,"./base":13}],17:[function(t,e,i){"use strict";var s=6,o=t("./vector_base"),a=t("../util"),r=(t("../constant"),t("../object/shot")),n=t("../enemy/bullet_dictionaries"),h=5,p=function(t){o.apply(this,arguments),this.indexX=0,this.indexY=0};a.inherit(p,o),p.prototype.init=function(t){this.x=t.x||0,this.y=t.y||0,o.prototype.init.apply(this,[t.vector]),this.vital=t.vital,this.powerItem=t.powerItem,this.scoreItem=t.scoreItem,this.shots=t.shot,this.shot_index=0,this.indexY=t.type?2*t.type:s},p.prototype.run=function(){o.prototype.run.apply(this,arguments),this.shot(),this.frame_count%h===0&&(this.indexX++,this.indexX>2&&(this.indexX=0))},p.prototype.shot=function(){if(this.shots)for(;this.shots[this.shot_index]&&this.shots[this.shot_index].count<=this.frame_count;){for(var t=n[this.shots[this.shot_index].bullet],e=0,i=t.length;i>e;e++){var s=t[e];this.stage.bullet_manager.create(2,this.x,this.y,s.vector)}this.game.playSound("boss_shot_small"),this.shot_index++}},p.prototype.notifyCollision=function(t){t instanceof r&&this.die()},p.prototype.notifyUseBomb=function(){this.die()},p.prototype.die=function(){this.stage.enemy_manager.remove(this.id),this.game.playSound("enemy_vanish"),this.stage.score+=100,this.stage.effect_manager.create(this.x,this.y),
(this.powerItem||this.scoreItem)&&this.stage.item_manager.create(0,this.x,this.y)},p.prototype.collisionWidth=function(){return 20},p.prototype.collisionHeight=function(){return 28},p.prototype.spriteX=function(){return this.indexX},p.prototype.spriteY=function(){return this.indexY},p.prototype.spriteImage=function(){return"enemy"},p.prototype.spriteWidth=function(){return 32},p.prototype.spriteHeight=function(){return 32},e.exports=p},{"../constant":2,"../enemy/bullet_dictionaries":3,"../object/shot":19,"../util":45,"./vector_base":20}],18:[function(t,e,i){"use strict";var s=t("./vector_base"),o=t("../util"),a=function(t,e){s.apply(this,arguments),this.indexX=0,this.indexY=0};o.inherit(a,s),a.prototype.init=function(t,e,i){this.x=e,this.y=i,s.prototype.init.apply(this,[[{count:0,vector:{r:4,theta:270,ra:-.1,rrange:{min:-3}},is_rotate:!1}]]),this.indexX=0,this.indexY=0,this.is_graze=!1},a.prototype.run=function(){(this.is_graze||this.stage.character.is_using_bomb)&&this.setVector([{count:0,vector:{r:10,aimed:!0}}]),s.prototype.run.apply(this,arguments)},a.prototype.notifyCollision=function(t){this.stage.item_manager.remove(this.id),this.game.playSound("graze"),this.stage.score+=1e3},a.prototype.notifyGraze=function(t){this.is_graze=!0},a.prototype.collisionWidth=function(){return 60},a.prototype.collisionHeight=function(){return 60},a.prototype.grazeHeight=function(){return 100},a.prototype.grazeWidth=function(){return 100},a.prototype.spriteX=function(){return this.indexX},a.prototype.spriteY=function(){return this.indexY},a.prototype.spriteImage=function(){return"item"},a.prototype.spriteWidth=function(){return 16},a.prototype.spriteHeight=function(){return 16},e.exports=a},{"../util":45,"./vector_base":20}],19:[function(t,e,i){"use strict";var s=t("./vector_base"),o=t("../util"),a=(t("../constant"),t("../shot_types")),r=function(t){s.apply(this,arguments)};o.inherit(r,s),r.prototype.init=function(t,e,i,o){this.x=e,this.y=i;var r=a[t];s.prototype.init.apply(this,[[{count:0,vector:o,is_rotate:r.is_rotate}]]),this.image=r.image,this.indexX=r.indexX,this.indexY=r.indexY,this.width=r.width,this.height=r.height,this.collision_width=r.collisionWidth,this.collision_height=r.collisionHeight,this.is_penetration=r.is_penetration},r.prototype.run=function(){s.prototype.run.apply(this,arguments)},r.prototype.collisionWidth=function(){return this.collision_width},r.prototype.collisionHeight=function(){return this.collision_height},r.prototype.spriteX=function(){return this.indexX},r.prototype.spriteY=function(){return this.indexY},r.prototype.spriteImage=function(){return this.image},r.prototype.spriteWidth=function(){return this.width},r.prototype.spriteHeight=function(){return this.height},r.prototype.notifyCollision=function(t){this.is_penetration||this.stage.shot_manager.remove(this.id)},e.exports=r},{"../constant":2,"../shot_types":40,"../util":45,"./vector_base":20}],20:[function(t,e,i){"use strict";var s=t("./base"),o=t("../util"),a=(t("../constant"),function(t){s.apply(this,arguments)});o.inherit(a,s),a.prototype.init=function(t){s.prototype.init.apply(this,arguments),this.setVector(t)},a.prototype.setVector=function(t){this.vectors=[],this.vector_index=0;for(var e,i=0,s=t.length;s>i;i++)e=t[i],this.vectors.push({count:e.count,r:e.vector.r,theta:e.vector.theta||0,w:e.vector.w||0,ra:e.vector.ra||0,wa:e.vector.wa||0,raa:e.vector.raa||0,waa:e.vector.waa||0,trange:e.vector.trange||null,rrange:e.vector.rrange||null,wrange:e.vector.wrange||null,rarange:e.vector.rarange||null,warange:e.vector.warange||null,aimed:e.vector.aimed,is_rotate:e.is_rotate});this._calculateAimedVector()},a.prototype._calculateAimedVector=function(){for(var t=0,e=this.vectors.length;e>t;t++)if(this.vectors[t].aimed){var i=this.stage.character,s=i.x-this.x,o=i.y-this.y;this.vectors[t].theta=this._radian_to_theta(Math.atan2(o,s))}},a.prototype.run=function(){if(s.prototype.run.apply(this,arguments),this.vectors[this.vector_index+1]&&this.vectors[this.vector_index+1].count<=this.frame_count){var t=this.vectors[this.vector_index].theta;this.vector_index++,t&&!this.vectors[this.vector_index].theta&&(this.vectors[this.vector_index].theta=t)}this.x+=this.calc_moveX(),this.y+=this.calc_moveY();var e=this.vectors[this.vector_index];e.theta+=e.w,e.r+=e.ra,e.w+=e.wa,e.ra+=e.raa,e.wa+=e.waa,e.theta=this._beInRange(e.theta,e.trange),e.r=this._beInRange(e.r,e.rrange),e.w=this._beInRange(e.w,e.wrange),e.ra=this._beInRange(e.ra,e.rarange),e.wa=this._beInRange(e.wa,e.warange),e.is_rotate&&(this.rotate=this._theta_to_radian(e.theta+90))},a.prototype._beInRange=function(t,e){return null===e?t:(void 0!==e.max&&t>e.max&&(t=e.max),void 0!==e.min&&t<e.min&&(t=e.min),t)},a.prototype._theta_to_radian=function(t){return t/180*Math.PI},a.prototype._radian_to_theta=function(t){return 180*t/Math.PI|0},a.prototype.calc_moveX=function(){var t=this.vectors[this.vector_index],e=t.r*Math.cos(this._theta_to_radian(t.theta));return e},a.prototype.calc_moveY=function(){var t=this.vectors[this.vector_index],e=t.r*Math.sin(this._theta_to_radian(t.theta));return e},e.exports=a},{"../constant":2,"../util":45,"./base":13}],21:[function(t,e,i){"use strict";var s=function(t){this.game=t,this.frame_count=0};s.prototype.init=function(){this.frame_count=0},s.prototype.run=function(){this.frame_count++},s.prototype.updateDisplay=function(){console.error("updateDisplay method must be overridden")},s.prototype.onunload=function(){this.game.stopBGM()},e.exports=s},{}],22:[function(t,e,i){"use strict";var s=t("./base"),o=t("../util"),a=(t("../constant"),t("../config"),function(t){s.apply(this,arguments)});o.inherit(a,s),a.prototype.init=function(){s.prototype.init.apply(this,arguments)},a.prototype.run=function(){s.prototype.run.apply(this,arguments)},a.prototype.updateDisplay=function(){this.game.clearCanvas(),this._showBG()},a.prototype._showBG=function(){var t=this.game.surface;t.fillStyle="rgb(0, 0, 0)",t.fillRect(0,0,this.game.width,this.game.height),t.save(),t.fillStyle="rgb( 6, 40, 255 )",t.textAlign="left",t.font="16px 'Migu'",t.fillText("エンディング(仮画面)",30,30),t.restore()},e.exports=a},{"../config":1,"../constant":2,"../util":45,"./base":21}],23:[function(t,e,i){"use strict";var s=t("./base"),o=t("../util"),a=t("../constant"),r=t("../config"),n=t("../serif/epilogue1"),h=t("../logic/serif"),p=function(t){s.apply(this,arguments),this.serif=new h(n)};o.inherit(p,s),p.prototype.init=function(){s.prototype.init.apply(this,arguments),r.DEBUG&&(this.serif.script=JSON.parse(document.getElementById("epilogue1").value)),this.serif.init()},p.prototype.run=function(){s.prototype.run.apply(this,arguments),60===this.frame_count&&this.game.playBGM("epilogue"),this.game.isKeyPush(a.BUTTON_Z)&&(this.serif.is_end()?this.game.notifyEpilogue1Done():this.serif.next())},p.prototype.updateDisplay=function(){this.game.clearCanvas();this.game.surface;this._showBG(),this.serif.right_image()&&this._showRightChara(),this.serif.right_name()&&this._showName(this.serif.right_name(),r.PROLOGUE2_RIGHT_NAME_WINDOW_X,r.PROLOGUE2_RIGHT_NAME_WINDOW_Y),this.serif.left_image()&&this._showLeftChara(),this.serif.left_name()&&this._showName(this.serif.left_name(),r.PROLOGUE2_LEFT_NAME_WINDOW_X,r.PROLOGUE2_LEFT_NAME_WINDOW_Y),this.serif.serif_window()&&this._showMessageWindow(),this._showMessage()},p.prototype._showBG=function(){var t=this.game.surface,e=this.game.getImage("epilogue1_bg");t.save(),t.drawImage(e,0,0,e.width,e.height,0,0,this.game.width,this.game.height),t.restore()},p.prototype._showRightChara=function(){var t=this.game.surface;t.save();var e=r.PROLOGUE2_RIGHT_X,i=r.PROLOGUE2_RIGHT_Y;this.serif.is_right_talking()?(e-=r.TALKER_MOVE_PX,i-=r.TALKER_MOVE_PX):t.globalAlpha=.5;var s=this.game.getImage(this.serif.right_image());t.drawImage(s,e,i,s.width*r.CHARA_SIZE_RATIO,s.height*r.CHARA_SIZE_RATIO),t.restore()},p.prototype._showLeftChara=function(){var t=this.game.surface;t.save();var e=r.PROLOGUE2_LEFT_X,i=r.PROLOGUE2_LEFT_Y;this.serif.is_left_talking()?(e-=-r.TALKER_MOVE_PX,i-=r.TALKER_MOVE_PX):t.globalAlpha=.5;var s=this.game.getImage(this.serif.left_image());t.transform(-1,0,0,1,s.width*r.CHARA_SIZE_RATIO,0),t.drawImage(s,-e,i,s.width*r.CHARA_SIZE_RATIO,s.height*r.CHARA_SIZE_RATIO),t.restore()},p.prototype._showName=function(t,e,i){var s=this.game.surface;s.save();var o=this.game.getImage(t);s.drawImage(o,e,i,o.width*r.CHARA_SIZE_RATIO,o.height*r.CHARA_SIZE_RATIO),s.restore()},p.prototype._showMessageWindow=function(){var t=this.game.surface;t.save();var e=r.PROLOGUE2_SERIF_WINDOW_X,i=r.PROLOGUE2_SERIF_WINDOW_Y,s=this.game.getImage(this.serif.serif_window());this.serif.is_right_talking()&&(e=-e,t.transform(-1,0,0,1,s.width*r.CHARA_SIZE_RATIO,0)),t.drawImage(s,e,i,s.width*r.CHARA_SIZE_RATIO,s.height*r.CHARA_SIZE_RATIO),t.restore()},p.prototype._showMessage=function(){var t=this.game.surface;t.save(),t.font="18px 'Migu'",t.textAlign="left",t.textBaseAlign="middle",t.fillStyle="rgb( 0, 0, 0 )";var e,i=this.serif.lines();if(i.length){e=80;for(var s=0,o=i.length;o>s;s++)t.fillText(i[s],200,e),e+=30}t.restore()},e.exports=p},{"../config":1,"../constant":2,"../logic/serif":10,"../serif/epilogue1":35,"../util":45,"./base":21}],24:[function(t,e,i){"use strict";var s=600,o=t("./base"),a=t("../util"),r=(t("../constant"),t("../config"),function(t){o.apply(this,arguments)});a.inherit(r,o),r.prototype.init=function(){o.prototype.init.apply(this,arguments)},r.prototype.run=function(){o.prototype.run.apply(this,arguments),s+300<this.frame_count},r.prototype.updateDisplay=function(){this.game.clearCanvas(),this._showBG()},r.prototype._showBG=function(){var t=this.game.surface;if(t.fillStyle="rgb(0, 0, 0)",t.fillRect(0,0,this.game.width,this.game.height),t.save(),this.frame_count<s){this._setTransition();var e=this.game.getImage("epilogue2_1_bg");t.drawImage(e,0,0,e.width,e.height,0,0,this.game.width,this.game.height)}else{var i=this.game.getImage("epilogue2_2_bg");t.drawImage(i,0,0,i.width,i.height,0,0,this.game.width,this.game.height)}t.restore()},r.prototype._setTransition=function(){var t=this.game.surface,e=1;this.frame_count<s/3?e=3*this.frame_count/s:s/3<this.frame_count&&this.frame_count<2*s/3?e=1:2*s/3<this.frame_count&&(e=3*(s-this.frame_count)/s),t.globalAlpha=e},e.exports=r},{"../config":1,"../constant":2,"../util":45,"./base":21}],25:[function(t,e,i){"use strict";var s=t("../util"),o=t("../config"),a=t("./base"),r=function(t){a.apply(this,arguments),this.loadedImageNum=0,this.loadedSoundNum=0,this.loadedBGMNum=0,this.fontLoadingDone=!1};s.inherit(r,a),r.prototype.init=function(){this._loadImages(),this._loadSounds(),this._loadBGMs()},r.prototype.loaded_material_num=function(){return this.loadedImageNum+this.loadedSoundNum+this.loadedBGMNum},r.prototype.notifyFontLoadingDone=function(){this.fontLoadingDone=!0},r.prototype.run=function(){this.loaded_material_num()>=o.ALL_MATERIAL_NUM&&this.fontLoadingDone&&this.game.notifyLoadingDone()},r.prototype.updateDisplay=function(){this.game.clearCanvas();var t=o.ALL_MATERIAL_NUM,e=this.loaded_material_num(),i=this.game.surface;i.save(),i.fillStyle="rgb( 0, 0, 0 )",i.textAlign="right",i.font="30px 'Migu'",i.fillText("Now Loading...",400,225),i.fillText(e+"/"+t,400,285),i.restore()},r.prototype._loadImages=function(){var t,e=this,i=function(){e.loadedImageNum++};for(var s in o.IMAGES)t=new Image,t.src=o.IMAGES[s],t.onload=i,this.game.images[s]=t},r.prototype._loadSounds=function(){var t,e,i=this,s=function(){i.loadedBGMNum++};for(var a in o.SOUNDS)t=o.SOUNDS[a],e=new Audio(t.path),e.volume=t.volume,e.addEventListener("canplay",s),e.load(),this.game.sounds[a]=e},r.prototype._loadBGMs=function(){var t=this;for(var e in o.BGMS)!function(e){var i=o.BGMS[e];t._loadBGM(i.path,function(i){t.loadedBGMNum++,t.game.bgms[e]=i})}(e)},r.prototype._loadBGM=function(t,e){var i=this,s=new XMLHttpRequest;s.onload=function(){if(200===s.status){var t=s.response;i.game.audio_context.decodeAudioData(t,e,function(t){t instanceof Error?window.alert(t.message):window.alert('Error : "decodeAudioData" method.')})}},s.open("GET",t,!0),s.responseType="arraybuffer",s.send(null)},e.exports=r},{"../config":1,"../util":45,"./base":21}],26:[function(t,e,i){"use strict";var s=t("../serif/prologue1"),o=900,a=115,r=150,n=27,h=12,p=t("./base"),u=t("../util"),c=t("../constant"),l=t("../config"),g=function(t){p.apply(this,arguments)};u.inherit(g,p),g.prototype.init=function(){p.prototype.init.apply(this,arguments)},g.prototype.run=function(){p.prototype.run.apply(this,arguments),(o<this.frame_count||this.game.isKeyPush(c.BUTTON_Z))&&this.game.notifyPrologue1Done()},g.prototype.updateDisplay=function(){this.game.clearCanvas();this.game.surface;this._showBG(),this._showMessage()},g.prototype._showBG=function(){var t=this.game.surface,e=this.game.getImage("prologue1_bg");t.drawImage(e,0,0,e.width,e.height,0,0,this.game.width,this.game.height)},g.prototype._setTransition=function(){var t=this.game.surface,e=1;this.frame_count<o/3?e=3*this.frame_count/o:o/3<this.frame_count&&this.frame_count<2*o/3?e=1:2*o/3<this.frame_count&&(e=3*(o-this.frame_count)/o),t.globalAlpha=e},g.prototype._showMessage=function(){var t=this.game.surface;if(t.save(),this._setTransition(),o>this.frame_count){t.font=n+"px 'Migu'",t.textBaseAlign="middle",t.fillStyle="rgb( 255, 255, 255 )";var e=l.DEBUG?document.getElementById("prologue1").value.split("\n"):s.split("\n");if(e.length)for(var i=r,p=0,u=e.length;u>p;p++)t.fillText(e[p],a,i),i+=n+h}t.restore()},e.exports=g},{"../config":1,"../constant":2,"../serif/prologue1":36,"../util":45,"./base":21}],27:[function(t,e,i){"use strict";var s=t("./base"),o=t("../util"),a=t("../constant"),r=t("../config"),n=t("../serif/prologue2"),h=t("../logic/serif"),p=function(t){s.apply(this,arguments),this.serif=new h(n)};o.inherit(p,s),p.prototype.init=function(){s.prototype.init.apply(this,arguments),r.DEBUG&&(this.serif.script=JSON.parse(document.getElementById("prologue2").value)),this.serif.init()},p.prototype.run=function(){s.prototype.run.apply(this,arguments),60===this.frame_count&&this.game.playBGM("prologue"),this.game.isKeyPush(a.BUTTON_Z)&&(this.serif.is_end()?this.game.notifyPrologue2Done():this.serif.next())},p.prototype.updateDisplay=function(){this.game.clearCanvas();this.game.surface;this._showBG(),this.serif.right_image()&&this._showRightChara(),this.serif.right_name()&&this._showName(this.serif.right_name(),r.PROLOGUE2_RIGHT_NAME_WINDOW_X,r.PROLOGUE2_RIGHT_NAME_WINDOW_Y),this.serif.left_image()&&this._showLeftChara(),this.serif.left_name()&&this._showName(this.serif.left_name(),r.PROLOGUE2_LEFT_NAME_WINDOW_X,r.PROLOGUE2_LEFT_NAME_WINDOW_Y),this.serif.serif_window()&&this._showMessageWindow(),this._showMessage()},p.prototype._showBG=function(){var t=this.game.surface,e=this.game.getImage("prologue2_bg");t.save(),t.drawImage(e,0,0,e.width,e.height,0,0,this.game.width,this.game.height),t.restore()},p.prototype._showRightChara=function(){var t=this.game.surface;t.save();var e=r.PROLOGUE2_RIGHT_X,i=r.PROLOGUE2_RIGHT_Y;this.serif.is_right_talking()?(e-=r.TALKER_MOVE_PX,i-=r.TALKER_MOVE_PX):t.globalAlpha=.5;var s=this.game.getImage(this.serif.right_image());t.drawImage(s,e,i,s.width*r.CHARA_SIZE_RATIO,s.height*r.CHARA_SIZE_RATIO),t.restore()},p.prototype._showLeftChara=function(){var t=this.game.surface;t.save();var e=r.PROLOGUE2_LEFT_X,i=r.PROLOGUE2_LEFT_Y;this.serif.is_left_talking()?(e-=-r.TALKER_MOVE_PX,i-=r.TALKER_MOVE_PX):t.globalAlpha=.5;var s=this.game.getImage(this.serif.left_image());t.transform(-1,0,0,1,s.width*r.CHARA_SIZE_RATIO,0),t.drawImage(s,-e,i,s.width*r.CHARA_SIZE_RATIO,s.height*r.CHARA_SIZE_RATIO),t.restore()},p.prototype._showName=function(t,e,i){var s=this.game.surface;s.save();var o=this.game.getImage(t);s.drawImage(o,e,i,o.width*r.CHARA_SIZE_RATIO,o.height*r.CHARA_SIZE_RATIO),s.restore()},p.prototype._showMessageWindow=function(){var t=this.game.surface;t.save();var e=r.PROLOGUE2_SERIF_WINDOW_X,i=r.PROLOGUE2_SERIF_WINDOW_Y,s=this.game.getImage(this.serif.serif_window());this.serif.is_right_talking()&&(e=-e,t.transform(-1,0,0,1,s.width*r.CHARA_SIZE_RATIO,0)),t.drawImage(s,e,i,s.width*r.CHARA_SIZE_RATIO,s.height*r.CHARA_SIZE_RATIO),t.restore()},p.prototype._showMessage=function(){var t=this.game.surface;t.save(),t.font="18px 'Migu'",t.textAlign="left",t.textBaseAlign="middle",t.fillStyle="rgb( 0, 0, 0 )";var e,i=this.serif.lines();if(i.length){e=80;for(var s=0,o=i.length;o>s;s++)t.fillText(i[s],200,e),e+=30}t.restore()},e.exports=p},{"../config":1,"../constant":2,"../logic/serif":10,"../serif/prologue2":37,"../util":45,"./base":21}],28:[function(t,e,i){"use strict";var s=160,o=3,a=3500,r=t("./base"),n=t("../util"),h=t("../config"),p=t("../constant"),u=t("./stage/state/way"),c=t("./stage/state/talk"),l=t("./stage/state/boss"),g=t("./stage/state/result"),f=t("./stage/state/result"),_=t("../object/character"),m=t("../object/shot"),y=t("../object/enemy"),d=t("../object/aya"),v=t("../object/bullet"),w=t("../object/effect"),b=t("../object/item"),x=t("../serif/stage1_before"),T=t("../serif/stage1_after"),E=t("../logic/manager"),I=function(t){r.apply(this,arguments),this.state=null,this.score=0,this.states=[],this.states[p.WAY_STATE]=new u(this),this.states[p.TALK1_STATE]=new c(this,x,p.BOSS_STATE),this.states[p.BOSS_STATE]=new l(this),this.states[p.TALK2_STATE]=new c(this,T,p.RESULT_STATE),this.states[p.RESULT_STATE]=new g(this),this.states[p.GAMEOVER_STATE]=new f(this),this.width=this.game.width-s,this.height=this.game.height,this.shot_manager=new E(m,this),this.character=new _(this),this.enemy_manager=new E(y,this),this.effect_manager=new E(w,this),this.objects=[this.shot_manager,this.character,this.enemy_manager,this.effect_manager],this.boss=new d(this),this.bullet_manager=new E(v,this),this.item_manager=new E(b,this)};n.inherit(I,r),I.prototype.init=function(){r.prototype.init.apply(this,arguments),this.state=null,this.score=0;for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].init();this.changeState(h.DEBUG&&h.DEBUG_STATE?h.DEBUG_STATE:p.WAY_STATE)},I.prototype.currentState=function(){return this.states[this.state]},I.prototype.changeState=function(t){this.state=t,this.currentState().init()},I.prototype.run=function(){r.prototype.run.apply(this,arguments);for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].run();this.currentState().run(),this.state===p.WAY_STATE&&this.frame_count===a?this.changeState(p.TALK1_STATE):this.state===p.BOSS_STATE&&this.boss.isDead()&&!this.boss.hasNextSpell()&&this.changeState(p.TALK2_STATE)},I.prototype.updateDisplay=function(){this.game.clearCanvas(),this._showBG();for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].updateDisplay();this.currentState().updateDisplay(),this._showSidebar()},I.prototype._showSidebar=function(){var t=this.game.surface,e=this.game.width-s,i=0;t.save();var o=this.game.getImage("side_bar");this.game.surface.drawImage(o,0,0,o.width,o.height,e,i,s,this.game.height),t.restore(),this._showText()},I.prototype._showText=function(){var t,e=18,i=21,o=this.game.width-s+10,a=this.game.width-s+35;switch(this.character.life){case 1:t="★";break;case 2:t="★★";break;case 3:t="★★★";break;case 4:t="★★★★";break;case 5:t="★★★★★";break;default:t=""}var r=this.game.surface;r.save(),r.fillStyle="rgb( 6, 40, 255 )",r.textAlign="left",r.font=e+"px 'Migu'",r.fillText("Score",o,70),r.fillText("Player",o,130),h.DEBUG&&r.fillText("Frame",o,235),r.font=i+"px 'Migu'",r.fillText(this.score,a,95),r.fillText(t,a,155);var n;switch(this.character.bombs){case 1:n="★";break;case 2:n="★★";break;case 3:n="★★★";break;case 4:n="★★★★";break;case 5:n="★★★★★";break;default:n=""}h.DEBUG&&r.fillText(this.frame_count,a,260),r.restore()},I.prototype._showBG=function(){var t=this.game.surface,e=0,i=this.frame_count*o%this.game.height;t.save();var a=this.game.getImage("stage1_bg");this.game.surface.drawImage(a,0,0,a.width,a.height,e,i,this.game.width-s,this.game.height),this.game.surface.drawImage(a,0,0,a.width,a.height,e,i-this.game.height,this.game.width-s,this.game.height),this.game.surface.restore()},I.prototype.notifyCharacterDead=function(){this.changeState(p.RESULT_STATE)},e.exports=I},{"../config":1,"../constant":2,"../logic/manager":9,"../object/aya":12,"../object/bullet":14,"../object/character":15,"../object/effect":16,"../object/enemy":17,"../object/item":18,"../object/shot":19,"../serif/stage1_after":38,"../serif/stage1_before":39,"../util":45,"./base":21,"./stage/state/boss":30,"./stage/state/result":31,"./stage/state/talk":32,"./stage/state/way":33}],29:[function(t,e,i){"use strict";var s=function(t){this.stage=t,this.game=t.game,this.frame_count=0};s.prototype.init=function(){this.frame_count=0},s.prototype.run=function(){this.frame_count++},s.prototype.updateDisplay=function(){console.error("updateDisplay method must be overridden")},e.exports=s},{}],30:[function(t,e,i){"use strict";var s=t("./base"),o=t("../../../util"),a=(t("../../../config"),t("../../../constant")),r=5,n=function(t){s.apply(this,arguments)};o.inherit(n,s),n.prototype.init=function(){s.prototype.init.apply(this,arguments),this.stage.boss.init(),this.stage.bullet_manager.init(),this.game.stopBGM()},n.prototype.run=function(){s.prototype.run.apply(this,arguments),1===this.frame_count&&this.game.playBGM("stage1");var t=this.stage.character;this.game.isKeyDown(a.BUTTON_Z)&&t.shot(),this.game.isKeyPush(a.BUTTON_X);var e=this.game.isKeyDown(a.BUTTON_Z);this.game.isKeyDown(a.BUTTON_LEFT)&&t.moveLeft(e),this.game.isKeyDown(a.BUTTON_RIGHT)&&t.moveRight(e),this.game.isKeyDown(a.BUTTON_DOWN)&&t.moveDown(e),this.game.isKeyDown(a.BUTTON_UP)&&t.moveUp(e),t.forbidOutOfStage(),this.game.isKeyDown(a.BUTTON_LEFT)&&!this.game.isKeyDown(a.BUTTON_RIGHT)?t.animateLeft():this.game.isKeyDown(a.BUTTON_RIGHT)&&!this.game.isKeyDown(a.BUTTON_LEFT)?t.animateRight():t.animateNeutral(),this.stage.item_manager.checkCollisionWithObject(t),this.stage.bullet_manager.checkCollisionWithObject(t),t.checkCollisionWithObject(this.stage.boss),this.stage.shot_manager.checkCollisionWithObject(this.stage.boss),this.stage.bullet_manager.checkGrazeWithObject(t),this.stage.boss.run(),this.stage.bullet_manager.run(),this.stage.item_manager.run()},n.prototype.updateDisplay=function(){this.stage.boss.updateDisplay(),this.stage.bullet_manager.updateDisplay(),this.stage.item_manager.updateDisplay(),this._showVital()},n.prototype._showVital=function(){var t=this.game.surface;t.save(),t.fillStyle="rgb( 255, 255, 255 )",t.fillRect(r,r,this.stage.boss.vital/this.stage.boss.max_vital*(this.stage.width-2*r),r),t.restore()},e.exports=n},{"../../../config":1,"../../../constant":2,"../../../util":45,"./base":29}],31:[function(t,e,i){"use strict";var s=t("./base"),o=t("../../../util"),a=(t("../../../config"),t("../../../constant")),r=50,n=100,h=function(t){s.apply(this,arguments)};o.inherit(h,s),h.prototype.init=function(){s.prototype.init.apply(this,arguments)},h.prototype.run=function(){s.prototype.run.apply(this,arguments),this.game.isKeyPush(a.BUTTON_Z)&&(this.game.playSound("select"),this.game.notifyGameOver())},h.prototype.updateDisplay=function(){this._showScoreWindow()},h.prototype._showScoreWindow=function(){var t=this.game.surface;t.save();var e=1;e=this.frame_count<n?this.frame_count/n:1,t.fillStyle="rgb( 0, 0, 0 )",t.globalAlpha=.5*e,t.fillRect(0,170,this.stage.width,100),t.globalAlpha=e,t.fillStyle="rgb( 255, 255, 255 )",t.textAlign="left",t.font="16px 'Migu'",t.fillText("Result",100,210),t.textAlign="right",t.fillText("Score: "+this.stage.score,380,210),t.fillRect(100,225,280,1),Math.floor(this.frame_count/r)%2===0&&t.fillText("Press Z to Quit",300,250),t.restore()},e.exports=h},{"../../../config":1,"../../../constant":2,"../../../util":45,"./base":29}],32:[function(t,e,i){"use strict";var s=t("./base"),o=t("../../../util"),a=t("../../../config"),r=t("../../../constant"),n=t("../../../logic/serif"),h=function(t,e,i){s.apply(this,arguments),this.serif=new n(e),this.next_state=i};o.inherit(h,s),h.prototype.init=function(){s.prototype.init.apply(this,arguments),a.DEBUG,this.serif.init()},h.prototype.run=function(){s.prototype.run.apply(this,arguments),this.game.isKeyPush(r.BUTTON_Z)&&(this.serif.is_end()?this.stage.changeState(this.next_state):this.serif.next())},h.prototype.updateDisplay=function(){this.game.surface;this.serif.right_image()&&this._showRightChara(),this.serif.right_name()&&this._showName(this.serif.right_name(),a.TALKING_RIGHT_NAME_WINDOW_X,a.TALKING_RIGHT_NAME_WINDOW_Y),this.serif.left_image()&&this._showLeftChara(),this.serif.left_name()&&this._showName(this.serif.left_name(),a.TALKING_LEFT_NAME_WINDOW_X,a.TALKING_LEFT_NAME_WINDOW_Y),this.serif.serif_window()&&this._showMessageWindow(),this._showMessage()},h.prototype._showRightChara=function(){var t=this.game.surface;t.save();var e=a.TALKING_RIGHT_X,i=a.TALKING_RIGHT_Y;this.serif.is_right_talking()?(e-=a.TALKER_MOVE_PX,i-=a.TALKER_MOVE_PX):t.globalAlpha=.5;var s=this.game.getImage(this.serif.right_image());t.drawImage(s,e,i,s.width*a.CHARA_SIZE_RATIO,s.height*a.CHARA_SIZE_RATIO),t.restore()},h.prototype._showLeftChara=function(){var t=this.game.surface;t.save();var e=a.TALKING_LEFT_X,i=a.TALKING_LEFT_Y;this.serif.is_left_talking()?(e-=-a.TALKER_MOVE_PX,i-=a.TALKER_MOVE_PX):t.globalAlpha=.5;var s=this.game.getImage(this.serif.left_image());t.transform(-1,0,0,1,s.width*a.CHARA_SIZE_RATIO,0),t.drawImage(s,-e,i,s.width*a.CHARA_SIZE_RATIO,s.height*a.CHARA_SIZE_RATIO),t.restore()},h.prototype._showName=function(t,e,i){var s=this.game.surface;s.save();var o=this.game.getImage(t);s.drawImage(o,e,i,o.width*a.CHARA_SIZE_RATIO,o.height*a.CHARA_SIZE_RATIO),s.restore()},h.prototype._showMessageWindow=function(){var t=this.game.surface;t.save();var e=a.TALKING_SERIF_WINDOW_X,i=a.TALKING_SERIF_WINDOW_Y,s=this.game.getImage(this.serif.serif_window());this.serif.is_right_talking()&&(e=-e,t.transform(-1,0,0,1,s.width*a.CHARA_SIZE_RATIO,0)),t.drawImage(s,e,i,s.width*a.CHARA_SIZE_RATIO,s.height*a.CHARA_SIZE_RATIO),t.restore()},h.prototype._showMessage=function(){var t=this.game.surface;t.save(),t.font="18px 'Migu'",t.textAlign="left",t.textBaseAlign="middle",t.fillStyle="rgb( 0, 0, 0 )";var e,i=this.serif.lines();if(i.length){e=80;for(var s=0,o=i.length;o>s;s++)t.fillText(i[s],120,e),e+=30}t.restore()},e.exports=h},{"../../../config":1,"../../../constant":2,"../../../logic/serif":10,"../../../util":45,"./base":29}],33:[function(t,e,i){"use strict";var s=t("./base"),o=t("../../../util"),a=(t("../../../config"),t("../../../constant")),r=t("../../../logic/enemy_appear"),n=t("../../../enemy/stage1"),h=function(t){s.apply(this,arguments),this.enemy_appear=new r(n)};o.inherit(h,s),h.prototype.init=function(){s.prototype.init.apply(this,arguments),this.stage.bullet_manager.init(),this.stage.item_manager.init(),this.enemy_appear.init()},h.prototype.run=function(){s.prototype.run.apply(this,arguments),60===this.frame_count&&this.game.playBGM("douchu");var t=this.stage.character;this.game.isKeyDown(a.BUTTON_Z)&&t.shot(),this.game.isKeyPush(a.BUTTON_X);var e=this.game.isKeyDown(a.BUTTON_Z);this.game.isKeyDown(a.BUTTON_LEFT)&&t.moveLeft(e),this.game.isKeyDown(a.BUTTON_RIGHT)&&t.moveRight(e),this.game.isKeyDown(a.BUTTON_DOWN)&&t.moveDown(e),this.game.isKeyDown(a.BUTTON_UP)&&t.moveUp(e),t.forbidOutOfStage(),this.game.isKeyDown(a.BUTTON_LEFT)&&!this.game.isKeyDown(a.BUTTON_RIGHT)?t.animateLeft():this.game.isKeyDown(a.BUTTON_RIGHT)&&!this.game.isKeyDown(a.BUTTON_LEFT)?t.animateRight():t.animateNeutral(),this.stage.item_manager.checkCollisionWithObject(t),this.stage.enemy_manager.checkCollisionWithObject(t),this.stage.bullet_manager.checkCollisionWithObject(t),this.stage.enemy_manager.checkCollisionWithManager(this.stage.shot_manager),this.stage.bullet_manager.checkGrazeWithObject(t),this.stage.item_manager.checkGrazeWithObject(t);for(var i=this.enemy_appear.get(this.frame_count),o=0,r=i.length;r>o;o++)this.stage.enemy_manager.create(i[o]);this.stage.bullet_manager.run(),this.stage.item_manager.run()},h.prototype.updateDisplay=function(){this.stage.bullet_manager.updateDisplay(),this.stage.item_manager.updateDisplay()},e.exports=h},{"../../../config":1,"../../../constant":2,"../../../enemy/stage1":5,"../../../logic/enemy_appear":7,"../../../util":45,"./base":29}],34:[function(t,e,i){"use strict";var s=t("./base"),o=t("../util"),a=t("../constant"),r=t("../config"),n=100,h=50,p=function(t){s.apply(this,arguments)};o.inherit(p,s),p.prototype.init=function(){s.prototype.init.apply(this,arguments)},p.prototype.run=function(){s.prototype.run.apply(this,arguments),60===this.frame_count&&this.game.playBGM("title"),this.game.isKeyPush(a.BUTTON_Z)&&(this.game.playSound("select"),this.game.notifyTitleDone())},p.prototype.updateDisplay=function(){this.game.clearCanvas();var t=this.game.surface;t.save(),this.frame_count<n?t.globalAlpha=this.frame_count/n:t.globalAlpha=1;var e=this.game.getImage("title_bg"),i=this.game.getImage("press_z");t.drawImage(e,0,0,e.width,e.height,0,0,this.game.width,this.game.height),Math.floor(this.frame_count/h)%2===0&&t.drawImage(i,248,247,i.width*r.CHARA_SIZE_RATIO,i.height*r.CHARA_SIZE_RATIO),t.restore()},e.exports=p},{"../config":1,"../constant":2,"../util":45,"./base":21}],35:[function(t,e,i){"use strict";var s=[];e.exports=s},{}],36:[function(t,e,i){"use strict";var s=["私は博麗神社を目指していた。","「約束を守りなさい」","耳の奥で彼女の言葉が蘇る。","落ち着いた、私と瓜二つの声…。","彼女との出会いは、","ほんの15分ほど前のことだった。"].join("\n");e.exports=s},{}],37:[function(t,e,i){"use strict";var s=[{pos:"left",exp:"normal",chara:"renko",fukidashi:"normal",serif:null},{pos:"left",exp:"normal",chara:"renko",fukidashi:"normal",serif:"早朝の散歩も良いものね。"},{pos:"right",exp:null,chara:null,fukidashi:"normal",serif:"…約束を守りなさい。"},{pos:"left",exp:"calm",chara:"renko",fukidashi:"normal",serif:"ん…誰？\n誰かいるの？"},{pos:"right",exp:"normal",chara:"hatena",fukidashi:null,serif:"　"},{pos:"right",exp:"owata",chara:"hatena",fukidashi:"orange",serif:"わたしです"},{pos:"left",exp:"calm",chara:"renko",fukidashi:"normal",serif:"なんだ私か。"},{pos:"right",exp:"normal",chara:"hatena",fukidashi:"normal",serif:"え…。\nちょっとは驚きなさいよ。"},{pos:"left",exp:"calm",chara:"renko",fukidashi:"normal",serif:"驚いたわよ。"},{pos:"left",exp:"calm",chara:"renko",fukidashi:"normal",serif:"で、貴方誰なの？\n見たところ、私に\nそっくりだけど。"},{pos:"left",exp:"calm",chara:"renko",fukidashi:"orange",serif:"…ひょっとして、\nドッペルゲンガーってやつ？"},{pos:"right",exp:"normal",chara:"ganger",fukidashi:"normal",serif:"そのようなものね。\nそんなことより、\n貴方に大事な話があるの。"},{pos:"left",exp:"normal",chara:"renko",fukidashi:"normal",serif:"なにかしら。"},{pos:"right",exp:"normal",chara:"ganger",fukidashi:"normal",serif:"約束を守りなさい。"},{pos:"left",exp:"calm",chara:"renko",fukidashi:"normal",serif:"約束？\n何か約束してたっけ。"},{pos:"right",exp:"normal",chara:"ganger",fukidashi:"normal",serif:"ほら、博麗神社に…。"},{pos:"left",exp:"normal",chara:"renko",fukidashi:"orange",serif:"あぁ、そういえば前に\nメリーと約束してたわ。"},{pos:"right",exp:null,chara:null,fukidashi:null,serif:null},{pos:"left",exp:"normal",chara:"renko",fukidashi:"normal",serif:"博麗神社の入り口を\n調べようって。\nそのことかしら？"},{pos:"right",exp:"normal",chara:"merry",fukidashi:"orange",serif:"蓮子？\nこんなところで何してるの？"},{pos:"left",exp:"normal",chara:"renko",fukidashi:"orange",serif:"あ、噂をすれば。\nメリー、見て！\n私のドッペルゲンガーが…"},{pos:"right",exp:"normal",chara:null,fukidashi:"normal",serif:null},{pos:"left",exp:"calm",chara:"renko",fukidashi:"normal",serif:"あれ？いない…。"},{pos:"right",exp:"normal",chara:"merry",fukidashi:"normal",serif:"どうしたの？"},{pos:"left",exp:"calm",chara:"renko",fukidashi:"normal",serif:"それが、\nかくかくしかじかで。"},{pos:"right",exp:"normal",chara:"merry",fukidashi:"normal",serif:"ふーん。"},{pos:"left",exp:"normal",chara:"renko",fukidashi:"normal",serif:"覚えてる？前に博霊神社の\n入り口を調べようって\n約束してたこと。"},{pos:"right",exp:"normal",chara:"merry",fukidashi:"normal",serif:"そうだっけ？"},{pos:"left",exp:"normal",chara:"renko",fukidashi:"orange",serif:"ねえ、今から行ってみない？"},{pos:"right",exp:"trouble",chara:"merry",fukidashi:"normal",serif:"今から？面倒だわ…。"},{pos:"left",exp:"calm",chara:"renko",fukidashi:"normal",serif:"なんだか気になるのよ。"},{pos:"right",exp:"disappointed",chara:"merry",fukidashi:"normal",serif:"うっ…急にめまいと頭痛が。"
},{pos:"left",exp:"calm",chara:"renko",fukidashi:"normal",serif:"絶対嘘でしょ、それ。"},{pos:"right",exp:"disappointed",chara:"merry",fukidashi:"normal",serif:"全身の骨が折れてるかも。"},{pos:"left",exp:"surprised",chara:"renko",fukidashi:"purple",serif:"さっきまで\n元気だったじゃない！"},{pos:"right",exp:"trouble",chara:"merry",fukidashi:"normal",serif:"うーん、気が進まないわ。"},{pos:"left",exp:"disappointed",chara:"renko",fukidashi:"normal",serif:"はぁ…。そんなに嫌なら\n仕方ないわね。\n私一人で行ってくるわ。"}];e.exports=s},{}],38:[function(t,e,i){"use strict";var s=[{pos:"left",exp:"normal",chara:"renko",fukidashi:"normal",serif:null},{pos:"right",exp:"dissatisfied",chara:"aya",fukidashi:"normal",serif:"なんだ、ただの迷子ですか。\n記事にもなりませんね。"},{pos:"left",exp:"calm",chara:"renko",fukidashi:"normal",serif:"博麗神社に行きたいの。"},{pos:"right",exp:"normal",chara:"aya",fukidashi:"normal",serif:"神社？"},{pos:"right",exp:"smile",chara:"aya",fukidashi:"orange",serif:"この道をダーって行って\nキュって曲がってギャーン\nって行けばすぐですよ。"},{pos:"left",exp:"normal",chara:"renko",fukidashi:"orange",serif:"この道をダーって行って\nキュって曲がってギャーン\nね。ありがとう！"}];e.exports=s},{}],39:[function(t,e,i){"use strict";var s=[{pos:"left",exp:"calm",chara:"renko",fukidashi:"normal",serif:"見覚えのない場所に\n来てしまったわ。\n道に迷ったようね。"},{pos:"right",exp:"smile",chara:"aya",fukidashi:"orange",serif:"あやややや。\n挙動の不審な人間を\n発見しました！"},{pos:"left",exp:"normal",chara:"renko",fukidashi:"normal",serif:"あぁ、ちょうど良かったわ。\n博麗神社へはどう行けば…"},{pos:"right",exp:"smile",chara:"aya",fukidashi:"orange",serif:"早速、取材してみようと\n思います！"},{pos:"left",exp:"trouble",chara:"renko",fukidashi:"normal",serif:"もしもーし？"}];e.exports=s},{}],40:[function(t,e,i){"use strict";var s=[{image:"shot",indexX:0,indexY:2,width:20,height:20,collisionWidth:15,collisionHeight:15,is_rotate:!1,is_penetration:!1},{image:"shot",indexX:4,indexY:1,width:64,height:64,collisionWidth:64,collisionHeight:64,is_rotate:!1,is_penetration:!0}];e.exports=s},{}],41:[function(t,e,i){"use strict";var s=12,o=45,a=t("../stage1/base"),r=t("../../util"),n=function(t){a.apply(this,arguments)};r.inherit(n,a),n.prototype.init=function(){a.prototype.init.apply(this,arguments)},n.prototype.run=function(){if(a.prototype.run.apply(this,arguments),!this.isSpellStarting()&&this.frame_count%o===0){for(var t=0;s>t;t++)this.stage.shot_manager.create(1,this.stage.character.x,this.stage.character.y,{r:0,theta:(360/s|0)*t,ra:.05,raa:.01});this.game.playSound("boss_shot_big")}},n.prototype.name=function(){return"蓮子スペルカード1"},n.prototype.charaImage=function(){return"renko_normal"},e.exports=n},{"../../util":45,"../stage1/base":42}],42:[function(t,e,i){"use strict";var s=t("../../config"),o=t("../../constant"),a=33,r=1,n=332,h=30,p=10,u=45,c=5,l=function(t){this.frame_count=0,this.boss=t,this.stage=t.stage,this.game=t.stage.game,this.x=0,this.y=0,this.state=null};l.prototype.init=function(){this.frame_count=0,this.x=0,this.y=n,this.changeState(o.SPELLCARD_START_STATE)},l.prototype.isSpellExecute=function(){return this.state===o.SPELLCARD_EXEC_STATE?!0:!1},l.prototype.isSpellStarting=function(){return this.state===o.SPELLCARD_START_STATE?!0:!1},l.prototype.changeState=function(t){this.state=t},l.prototype.run=function(){this.frame_count++,this.isSpellStarting()&&(this.frame_count<h||(this.frame_count===h?this.game.playSound("spellcard"):h<this.frame_count&&this.frame_count<=h+p?this.x+=a:h+p<this.frame_count&&this.frame_count<=h+p+u?this.x+=r:h+p+u<this.frame_count&&this.frame_count<=h+p+u+c?this.x+=a:this.changeState(o.SPELLCARD_EXEC_STATE)))},l.prototype.updateDisplay=function(){if(this.isSpellStarting()&&!(this.frame_count<=h)){var t=this.game.surface,e=this.game.getImage(this.charaImage());t.save();var i=e.width*s.CHARA_SIZE_RATIO,o=e.height*s.CHARA_SIZE_RATIO;t.translate(this.x,this.y),t.globalAlpha=.7,t.drawImage(e,0,0,e.width,e.height,-i/2,-o/2,i,o),t.restore()}},l.prototype.name=function(){console.log("Spell's name method must be implemented")},l.prototype.charaImage=function(){console.log("Spell's charaImage method must be implemented")},l.prototype.shot=function(t,e,i,s,o,a){this.stage.bullet_manager.create(t,e,i,s,o,a)},e.exports=l},{"../../config":1,"../../constant":2}],43:[function(t,e,i){"use strict";var s=t("./base"),o=t("../../util"),a=(t("../../constant"),function(t){s.apply(this,arguments),this.shot_thetas1=[0,60,120,180,240,300],this.shot_thetas2=[0,60,120,180,240,300],this.maru_shot_theta=0,this.add_shot_theta=10,this.r=1.5,this.uzumaki_percount=15,this.maru_percount=75,this.maru_shot_pertheta=12});o.inherit(a,s),a.prototype.init=function(){s.prototype.init.apply(this,arguments),this.is_moving=!0},a.prototype.run=function(){if(s.prototype.run.apply(this,arguments),!this.isSpellStarting())if(this.is_moving){var t=this.stage.width/2-this.boss.x,e=this.stage.height/2-this.boss.y,i=this._radian_to_theta(Math.atan2(e,t));this.boss.animateRight(),this.boss.moveByTheta(i),Math.floor(this.boss.x)===Math.floor(this.stage.width/2)&&Math.floor(this.boss.y)===Math.floor(this.stage.height/2)&&(this.is_moving=!1,this.boss.animateNeutral())}else if(this.frame_count%this.uzumaki_percount===0&&(this.uzumaki_shot1(),this.uzumaki_shot2(),this.game.playSound("boss_shot_small")),this.frame_count%this.maru_percount===0){this.aimedToChara();for(var o=0;o<360/this.maru_shot_pertheta;o++)this.maru_shot(),this.maru_shot_theta+=this.maru_shot_pertheta;this.game.playSound("boss_shot_big")}},a.prototype.uzumaki_shot1=function(){for(var t=this.boss.x,e=this.boss.y,i=this.r,s=0;s<this.shot_thetas1.length;s++){var o=this.shot_thetas1[s];this.shot(0,t,e,{r:i,theta:o}),this.shot_thetas1[s]+=this.add_shot_theta}},a.prototype.uzumaki_shot2=function(){for(var t=this.boss.x,e=this.boss.y,i=this.r,s=0;s<this.shot_thetas2.length;s++){var o=this.shot_thetas2[s];this.shot(0,t,e,{r:i,theta:o}),this.shot_thetas2[s]-=this.add_shot_theta}},a.prototype.maru_shot=function(){var t=this.boss.x,e=this.boss.y,i=this.maru_shot_theta,s=this.r;this.shot(4,t,e,{r:s,theta:i})},a.prototype.aimedToChara=function(){var t=this.stage.character,e=t.x-this.boss.x,i=t.y-this.boss.y;this.maru_shot_theta=this._radian_to_theta(Math.atan2(i,e))},a.prototype._radian_to_theta=function(t){return 180*t/Math.PI|0},a.prototype.name=function(){return"風符「天狗風」"},a.prototype.charaImage=function(){return"aya_normal"},e.exports=a},{"../../constant":2,"../../util":45,"./base":42}],44:[function(t,e,i){"use strict";var s=t("./base"),o=t("../../util"),a=(t("../../constant"),function(t){s.apply(this,arguments),this.maru_shot_theta=0,this.r=1.5,this.maru_percount1=100,this.maru_shot_pertheta=10});o.inherit(a,s),a.prototype.init=function(){s.prototype.init.apply(this,arguments)},a.prototype.run=function(){if(s.prototype.run.apply(this,arguments),!this.isSpellStarting()){var t=600,e=this.frame_count%3600;if(e>=t&&t+60>e)this.boss.moveLeft(),this.boss.animateLeft();else if(e>=2*t+60&&2*t+120>e)this.boss.moveRight(),this.boss.moveDown(),this.boss.animateRight();else if(e>=3*t+120&&3*t+180>e)this.boss.moveRight(),this.boss.moveUp(),this.boss.animateRight();else if(e>=4*t+180&&4*t+240>e)this.boss.moveLeft(),this.boss.animateLeft();else{if(this.frame_count%this.maru_percount1===0||this.frame_count%this.maru_percount1===10||this.frame_count%this.maru_percount1===20){this.aimedToChara();for(var i=0;i<360/this.maru_shot_pertheta;i++)this.maru_shot(),this.maru_shot_theta+=this.maru_shot_pertheta;this.game.playSound("boss_shot_big")}this.boss.animateNeutral()}}},a.prototype.maru_shot=function(){var t=this.boss.x,e=this.boss.y,i=this.maru_shot_theta,s=this.r;this.shot(3,t,e,{r:s,theta:i})},a.prototype.aimedToChara=function(){var t=this.stage.character,e=t.x-this.boss.x,i=t.y-this.boss.y;this.maru_shot_theta=this._radian_to_theta(Math.atan2(i,e))},a.prototype._radian_to_theta=function(t){return 180*t/Math.PI|0},a.prototype.name=function(){return"風符「天狗風」"},a.prototype.charaImage=function(){return"aya_normal"},e.exports=a},{"../../constant":2,"../../util":45,"./base":42}],45:[function(t,e,i){"use strict";var s={inherit:function(t,e){var i=function(t){if(Object.create)return Object.create(t);var e=function(){};return e.prototype=t,new e};t.prototype=i(e.prototype),t.prototype.constructor=t}};e.exports=s},{}]},{},[11]);