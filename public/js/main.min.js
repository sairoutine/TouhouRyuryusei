!function t(e,i,n){function a(o,r){if(!i[o]){if(!e[o]){var h="function"==typeof require&&require;if(!r&&h)return h(o,!0);if(s)return s(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var g=i[o]={exports:{}};e[o][0].call(g.exports,function(t){var i=e[o][1][t];return a(i?i:t)},g,g.exports,t,e,i,n)}return i[o].exports}for(var s="function"==typeof require&&require,o=0;o<n.length;o++)a(n[o]);return a}({1:[function(t,e,i){"use strict";var n={DEBUG:!0,IMAGES:{title_bg:"image/title_bg.png",prologue1_1_bg:"image/prologue_bg.png",prologue2_bg:"image/prologue_bg.png",logo:"image/logo.png",fukidashi_normal:"image/serif.png",aya_normal:"image/aya_normal.png",ganger_normal:"image/ganger_normal.png",hatena_normal:"image/ganger_normal.png",merry_normal:"image/merry_normal.png",renko_normal:"image/renko_normal.png",name_aya:"image/name_aya.png",name_ganger:"image/name_ganger.png",name_hatena:"image/name_hatena.png",name_merry:"image/name_merry.png",name_renko:"image/name_renko.png",name_yuka:"image/name_yuka.png",name_sanae:"image/name_sanae.png",name_yukari:"image/name_yukari.png",stage1_bg:"image/stage1_bg.png"},SOUNDS:{select:{id:1,path:"sound/select.wav",volume:.8}},BGMS:{title:{path:"bgm/title.mp3",volume:.4},prologue1:{path:"bgm/prologue.mp3",volume:.4},prologue2:{path:"bgm/prologue.mp3",volume:.4},douchu:{path:"bgm/douchu.mp3",volume:.4}},MESSAGE_SPEED:10,PROLOGUE2_LEFT_X:0,PROLOGUE2_LEFT_Y:132,PROLOGUE2_RIGHT_X:283,PROLOGUE2_RIGHT_Y:132,PROLOGUE2_SERIF_WINDOW_X:80,PROLOGUE2_SERIF_WINDOW_Y:0,PROLOGUE2_LEFT_NAME_WINDOW_X:0,PROLOGUE2_LEFT_NAME_WINDOW_Y:420,PROLOGUE2_RIGHT_NAME_WINDOW_X:280,PROLOGUE2_RIGHT_NAME_WINDOW_Y:420};n.ALL_MATERIAL_NUM=Object.keys(n.IMAGES).length+Object.keys(n.SOUNDS).length+Object.keys(n.BGMS).length,e.exports=n},{}],2:[function(t,e,i){"use strict";var n={DEBUG:!0,LOADING_SCENE:0,TITLE_SCENE:1,PROLOGUE1_SCENE:2,PROLOGUE2_SCENE:3,STAGE_SCENE:4,EPILOGUE_SCENE:5,ENDING_SCENE:6,BUTTON_LEFT:1,BUTTON_UP:2,BUTTON_RIGHT:4,BUTTON_DOWN:8,BUTTON_Z:16,BUTTON_X:32,BUTTON_SHIFT:64,BUTTON_SPACE:128,WAY_STATE:0,TALK_STATE:1,BOSS_STATE:2,RESULT_STATE:3};e.exports=n},{}],3:[function(t,e,i){"use strict";var n,a=t("./config"),s=t("./constant"),o=t("./scene/loading"),r=t("./scene/title"),h=t("./scene/prologue1"),u=t("./scene/prologue2"),g=t("./scene/stage"),l=function(t){this.surface=t.getContext("2d"),this.width=Number(t.getAttribute("width")),this.height=Number(t.getAttribute("height")),this.state=null,this.scenes=[],this.scenes[s.LOADING_SCENE]=new o(this),this.scenes[s.TITLE_SCENE]=new r(this),this.scenes[s.PROLOGUE1_SCENE]=new h(this),this.scenes[s.PROLOGUE2_SCENE]=new u(this),this.scenes[s.STAGE_SCENE]=new g(this),this.images={},this.sounds={},this.bgms={},this.soundflag=0,this.frame_count=0,this.keyflag=0,this.before_keyflag=0};l.prototype={init:function(){this.frame_count=0,this.keyflag=0,this.before_keyflag=0,this.changeScene(s.LOADING_SCENE)},fontLoadingDone:function(){this.state===s.LOADING_SCENE&&this.currentScene().notifyFontLoadingDone()},handleKeyDown:function(t){this.keyflag|=this._keyCodeToBitCode(t.keyCode),t.preventDefault()},handleKeyUp:function(t){this.keyflag&=~this._keyCodeToBitCode(t.keyCode),t.preventDefault()},isKeyDown:function(t){return this.keyflag&t},isKeyPush:function(t){return!(this.before_keyflag&t)&&this.keyflag&t},_keyCodeToBitCode:function(t){var e;switch(t){case 16:e=s.BUTTON_SHIFT;break;case 32:e=s.BUTTON_SPACE;break;case 37:e=s.BUTTON_LEFT;break;case 38:e=s.BUTTON_UP;break;case 39:e=s.BUTTON_RIGHT;break;case 40:e=s.BUTTON_DOWN;break;case 88:e=s.BUTTON_X;break;case 90:e=s.BUTTON_Z}return e},changeScene:function(t){this.state=t,this.currentScene().init()},playBGM:function(t){for(var e in this.bgms)this.bgms[e].pause(),this.bgms[e].currentTime=0;this.bgms[t].loop=!0,this.bgms[t].play()},playSound:function(t){this.soundflag|=a.SOUNDS[t].id},runPlaySound:function(){for(var t in a.SOUNDS)if(this.soundflag&a.SOUNDS[t].id){this.sounds[t].pause(),this.sounds[t].currentTime=0,this.sounds[t].play(),this.soundflag&=~a.SOUNDS[t].id;break}},getImage:function(t){return this.images[t]},currentScene:function(){return this.scenes[this.state]},clearCanvas:function(){this.surface.clearRect(0,0,this.width,this.height)},run:function(){this.currentScene().run(),this.currentScene().updateDisplay(),this.runPlaySound(),this.before_keyflag=this.keyflag,this.frame_count++,requestAnimationFrame(this.run.bind(this))},notifyLoadingDone:function(){this.changeScene(s.DEBUG&&n?n:s.TITLE_SCENE)},notifyTitleDone:function(){this.changeScene(s.PROLOGUE1_SCENE)},notifyPrologue1Done:function(){this.changeScene(s.PROLOGUE2_SCENE)},notifyPrologue2Done:function(){this.changeScene(s.STAGE_SCENE)}},e.exports=l},{"./config":1,"./constant":2,"./scene/loading":7,"./scene/prologue1":8,"./scene/prologue2":9,"./scene/stage":10,"./scene/title":11}],4:[function(t,e,i){"use strict";var n=t("../config"),a=function(t){this.timeoutID=null,this.script=t,this.progress=null,this.left_chara_id=null,this.left_exp=null,this.right_chara_id=null,this.right_exp=null,this.pos=null,this.fukidashi=null,this.line_num=0,this.printing_lines=[]};a.prototype.init=function(){this.progress=-1,this.timeoutID=null,this.left_chara_id=null,this.left_exp=null,this.right_chara_id=null,this.right_exp=null,this.pos=null,this.fukidashi=null,this.line_num=0,this.printing_lines=[],this.next()},a.prototype.is_end=function(){return this.progress+1===this.script.length},a.prototype.next=function(){this.progress++,n.DEBUG&&(this.script=JSON.parse(document.getElementById("prologue2").value));var t=this.script[this.progress];this._showChara(t),t.serif?this._printMessage(t.serif):this.next()},a.prototype._showChara=function(t){t.pos&&(this.pos=t.pos,this.fukidashi=t.fukidashi,"left"===t.pos?(this.left_chara_id=t.chara,this.left_exp=t.exp):"right"===t.pos&&(this.right_chara_id=t.chara,this.right_exp=t.exp))},a.prototype._printMessage=function(t){var e=this;null!==e.timeoutID&&(clearTimeout(e.timeoutID),e.timeoutID=null);var i=t.split(""),a=i.length,s=0;e.line_num=0,e.printing_lines=[];var o=function(){if(!(s>=a)){var t=n.MESSAGE_SPEED,r=i[s];s++,"\n"===r?e.line_num++:(e.printing_lines[e.line_num]||(e.printing_lines[e.line_num]=""),e.printing_lines[e.line_num]=e.printing_lines[e.line_num]+r),e.timeoutID=setTimeout(o,t)}};o()},a.prototype.right_image=function(){return this.right_chara_id?this.right_chara_id+"_"+this.right_exp:null},a.prototype.left_image=function(){return this.left_chara_id?this.left_chara_id+"_"+this.left_exp:null},a.prototype.right_name=function(){return this.right_chara_id?"name_"+this.right_chara_id:null},a.prototype.left_name=function(){return this.left_chara_id?"name_"+this.left_chara_id:null},a.prototype.serif_window=function(){return this.fukidashi?"fukidashi_"+this.fukidashi:null},a.prototype.is_left_talking=function(){return"left"===this.pos?!0:!1},a.prototype.is_right_talking=function(){return"right"===this.pos?!0:!1},a.prototype.lines=function(){return this.printing_lines},e.exports=a},{"../config":1}],5:[function(t,e,i){"use strict";var n=t("./game");window.onload=function(){var t=document.getElementById("mainCanvas"),e=new n(t);e.init(),window.onkeydown=function(t){e.handleKeyDown(t)},window.onkeyup=function(t){e.handleKeyUp(t)},document.fonts.onloadingdone=function(){e.fontLoadingDone()},e.run()},window.onerror=function(t,e,i,n,a){window.alert(t+"\n"+i+":"+n)}},{"./game":3}],6:[function(t,e,i){"use strict";var n=function(t){this.game=t,this.frame_count=0};n.prototype.init=function(){this.frame_count=0},n.prototype.handleKeyDown=function(t){},n.prototype.handleKeyUp=function(t){},n.prototype.run=function(){this.frame_count++},n.prototype.updateDisplay=function(){console.error("updateDisplay method must be overridden")},e.exports=n},{}],7:[function(t,e,i){"use strict";var n=t("../util"),a=t("../config"),s=t("./base"),o=function(t){s.apply(this,arguments),this.loadedImageNum=0,this.loadedSoundNum=0,this.loadedBGMNum=0,this.fontLoadingDone=!1};n.inherit(o,s),o.prototype.init=function(){this._loadImages(),this._loadSounds(),this._loadBGMs()},o.prototype.loaded_material_num=function(){return this.loadedImageNum+this.loadedSoundNum+this.loadedBGMNum},o.prototype.notifyFontLoadingDone=function(){this.fontLoadingDone=!0},o.prototype.run=function(){this.loaded_material_num()>=a.ALL_MATERIAL_NUM&&this.fontLoadingDone&&this.game.notifyLoadingDone()},o.prototype.updateDisplay=function(){this.game.clearCanvas();var t=a.ALL_MATERIAL_NUM,e=this.loaded_material_num(),i=this.game.surface;i.save(),i.fillStyle="rgb( 0, 0, 0 )",i.textAlign="right",i.font="30px 'Migu'",i.fillText("Now Loading...",400,225),i.fillText(e+"/"+t,400,285),i.restore()},o.prototype._loadImages=function(){var t,e=this,i=function(){e.loadedImageNum++};for(var n in a.IMAGES)t=new Image,t.src=a.IMAGES[n],t.onload=i,this.game.images[n]=t},o.prototype._loadSounds=function(){var t,e,i=this,n=function(){i.loadedBGMNum++};for(var s in a.SOUNDS)t=a.SOUNDS[s],e=new Audio(t.path),e.volume=t.volume,e.addEventListener("canplay",n),e.load(),this.game.sounds[s]=e},o.prototype._loadBGMs=function(){var t,e,i=this,n=function(){i.loadedBGMNum++};for(var s in a.BGMS)t=a.BGMS[s],e=new Audio(t.path),e.volume=t.volume,e.addEventListener("canplay",n),e.load(),this.game.bgms[s]=e},e.exports=o},{"../config":1,"../util":14,"./base":6}],8:[function(t,e,i){"use strict";var n=t("../serif/prologue1"),a=300,s=20,o=50,r=24,h=6,u=t("./base"),g=t("../util"),l=t("../constant"),p=t("../config"),f=function(t){u.apply(this,arguments)};g.inherit(f,u),f.prototype.init=function(){u.prototype.init.apply(this,arguments)},f.prototype.run=function(){u.prototype.run.apply(this,arguments),(a<this.frame_count||this.game.isKeyPush(l.BUTTON_Z))&&this.game.notifyPrologue1Done()},f.prototype.updateDisplay=function(){this.game.clearCanvas();this.game.surface;this._showBG(),this._showMessageWindow(),this._showMessage()},f.prototype._showBG=function(){var t=this.game.surface,e=this.game.getImage("prologue1_1_bg");t.drawImage(e,0,0,e.width,e.height,0,0,this.game.width,this.game.height)},f.prototype._showMessageWindow=function(){var t=this.game.surface;t.save(),t.globalAlpha=.5,t.fillStyle="rgb( 0, 0, 0 )",t.fillRect(s,s,this.game.width-2*s,this.game.height-2*s),t.restore()},f.prototype._setTransition=function(){var t=this.game.surface,e=1;this.frame_count<a/3?e=3*this.frame_count/a:a/3<this.frame_count&&this.frame_count<2*a/3?e=1:2*a/3<this.frame_count&&(e=3*(a-this.frame_count)/a),t.globalAlpha=e},f.prototype._showMessage=function(){var t=this.game.surface;if(t.save(),this._setTransition(),a>this.frame_count){t.font=r+"px 'Migu'",t.textBaseAlign="middle",t.fillStyle="rgb( 255, 255, 255 )";var e=p.DEBUG?document.getElementById("prologue1").value.split("\n"):n.split("\n");if(e.length)for(var i=o,s=0,u=e.length;u>s;s++)t.fillText(e[s],o,i),i+=r+h}t.restore()},e.exports=f},{"../config":1,"../constant":2,"../serif/prologue1":12,"../util":14,"./base":6}],9:[function(t,e,i){"use strict";var n=.5,a=5,s=t("./base"),o=t("../util"),r=t("../constant"),h=t("../config"),u=t("../serif/prologue2"),g=t("../logic/serif"),l=function(t){s.apply(this,arguments),this.serif=new g(u)};o.inherit(l,s),l.prototype.init=function(){s.prototype.init.apply(this,arguments),this.serif.init()},l.prototype.run=function(){s.prototype.run.apply(this,arguments),this.game.isKeyPush(r.BUTTON_Z)&&(this.serif.is_end()?this.game.notifyPrologue2Done():this.serif.next())},l.prototype.updateDisplay=function(){this.game.clearCanvas();this.game.surface;this._showBG(),this.serif.right_image()&&this._showRightChara(),this.serif.right_name()&&this._showName(this.serif.right_name(),h.PROLOGUE2_RIGHT_NAME_WINDOW_X,h.PROLOGUE2_RIGHT_NAME_WINDOW_Y),this.serif.left_image()&&this._showLeftChara(),this.serif.left_name()&&this._showName(this.serif.left_name(),h.PROLOGUE2_LEFT_NAME_WINDOW_X,h.PROLOGUE2_LEFT_NAME_WINDOW_Y),this.serif.serif_window()&&this._showMessageWindow(),this._showMessage()},l.prototype._showBG=function(){var t=this.game.surface,e=this.game.getImage("prologue2_bg");t.save(),t.drawImage(e,0,0,e.width,e.height,0,0,this.game.width,this.game.height),t.restore()},l.prototype._showRightChara=function(){var t=this.game.surface;t.save();var e=h.PROLOGUE2_RIGHT_X,i=h.PROLOGUE2_RIGHT_Y;this.serif.is_right_talking()?(e-=a,i-=a):t.globalAlpha=.5;var s=this.game.getImage(this.serif.right_image());t.drawImage(s,e,i,s.width*n,s.height*n),t.restore()},l.prototype._showLeftChara=function(){var t=this.game.surface;t.save();var e=h.PROLOGUE2_LEFT_X,i=h.PROLOGUE2_LEFT_Y;this.serif.is_left_talking()?(e-=-a,i-=a):t.globalAlpha=.5;var s=this.game.getImage(this.serif.left_image());t.transform(-1,0,0,1,s.width*n,0),t.drawImage(s,-e,i,s.width*n,s.height*n),t.restore()},l.prototype._showName=function(t,e,i){var a=this.game.surface;a.save();var s=this.game.getImage(t);a.drawImage(s,e,i,s.width*n,s.height*n),a.restore()},l.prototype._showMessageWindow=function(){var t=this.game.surface;t.save();var e=h.PROLOGUE2_SERIF_WINDOW_X,i=h.PROLOGUE2_SERIF_WINDOW_Y,a=this.game.getImage(this.serif.serif_window());this.serif.is_right_talking()&&(e=-e,t.transform(-1,0,0,1,a.width*n,0)),t.drawImage(a,e,i,a.width*n,a.height*n),t.restore()},l.prototype._showMessage=function(){var t=this.game.surface;t.save(),t.font="18px 'Migu'",t.textAlign="left",t.textBaseAlign="middle",t.fillStyle="rgb( 0, 0, 0 )";var e,i=this.serif.lines();if(i.length){e=80;for(var n=0,a=i.length;a>n;n++)t.fillText(i[n],200,e),e+=30}t.restore()},e.exports=l},{"../config":1,"../constant":2,"../logic/serif":4,"../serif/prologue2":13,"../util":14,"./base":6}],10:[function(t,e,i){"use strict";var n=160,a=2,s=t("./base"),o=t("../util"),r=t("../constant"),h=function(t){s.apply(this,arguments),this.state=null,this.states=[]};o.inherit(h,s),h.prototype.init=function(){s.prototype.init.apply(this,arguments),this.state=null,this.changeState(r.WAY_STATE)},h.prototype.currentState=function(){return this.states[this.state]},h.prototype.changeState=function(t){this.state=t},h.prototype.run=function(){s.prototype.run.apply(this,arguments)},h.prototype.updateDisplay=function(){this.game.clearCanvas(),this._showBG(),this._showSidebar()},h.prototype._showSidebar=function(){var t=this.game.surface,e=this.game.width-n,i=0;t.save(),t.fillStyle="rgb(0, 0, 0)",t.fillRect(e,i,n,this.game.height),t.fillStyle="rgb(255, 255, 255)",t.restore()},h.prototype._showBG=function(){var t=this.game.surface,e=0,i=this.frame_count*a%this.game.height;t.save();var s=this.game.getImage("stage1_bg");this.game.surface.drawImage(s,0,0,s.width,s.height,e,i,this.game.width-n,this.game.height),this.game.surface.drawImage(s,0,0,s.width,s.height,e,i-this.game.height,this.game.width-n,this.game.height),this.game.surface.restore()},e.exports=h},{"../constant":2,"../util":14,"./base":6}],11:[function(t,e,i){"use strict";var n=t("./base"),a=t("../util"),s=t("../constant"),o=100,r=50,h=function(t){n.apply(this,arguments)};a.inherit(h,n),h.prototype.init=function(){n.prototype.init.apply(this,arguments)},h.prototype.run=function(){n.prototype.run.apply(this,arguments),this.game.isKeyPush(s.BUTTON_Z)&&(this.game.playSound("select"),this.game.notifyTitleDone())},h.prototype.updateDisplay=function(){this.game.clearCanvas();var t=this.game.surface;t.save(),this.frame_count<o?t.globalAlpha=this.frame_count/o:t.globalAlpha=1;var e=this.game.getImage("title_bg");t.drawImage(e,0,0,e.width,e.height,0,0,this.game.width,this.game.height),t.font="24px 'Migu'",t.textAlign="center",t.textBaseAlign="middle",t.fillStyle="rgb( 0, 0, 0 )",Math.floor(this.frame_count/r)%2===0&&t.fillText("Press Z to Start",450,350),t.restore()},e.exports=h},{"../constant":2,"../util":14,"./base":6}],12:[function(t,e,i){"use strict";var n=["蝉の鳴き声が聞こえる。","蓮子は湖のほとりにきている。","メリーと湖で涼もうと約束していた。","蓮子は珍しく先に到着した。","携帯情報端末を見ると、","8月31日の午前9時50分を回ったところ。","夜なら星を見れば時間がわかるのだけど。","約束まで、あと10分。","メリーの事だから早めに来るだろう、","と考えていた時に、背後から物音が聞こえる。","メリーだと思い振り向くと、","自分にそっくりな容姿の女の子が立っていた。"].join("\n");e.exports=n},{}],13:[function(t,e,i){"use strict";var n=[{serif:null,fukidashi:null,chara:"ganger",pos:"right",exp:"normal"},{serif:null,fukidashi:null,chara:"renko",pos:"left",exp:"normal"},{serif:"約束を守りなさい。\n早く博霊神社に行かないと。",fukidashi:"normal",chara:"ganger",pos:"right",exp:"normal"},{serif:"え、そんな約束してたっけ？",fukidashi:"normal",chara:"renko",pos:"left",exp:"normal"},{serif:null,fukidashi:null,chara:"merry",pos:"right",exp:"normal"},{serif:"どうしたの？",fukidashi:"normal",chara:"merry",pos:"right",exp:"normal"},{serif:"実はかくかくしかじかで",fukidashi:"normal",chara:"renko",pos:"left",exp:"normal"},{serif:"ふーん",fukidashi:"normal",chara:"merry",pos:"right",exp:"normal"},{serif:"約束といえば、前に博霊神社の\n入り口を調べようって\n約束してたわね。",fukidashi:"normal",chara:"renko",pos:"left",exp:"normal"},{serif:"そうだっけ？",fukidashi:"normal",chara:"merry",pos:"right",exp:"normal"},{serif:"なんだか気になるわ。\nねえ、今から行ってみない？",fukidashi:"normal",chara:"renko",pos:"left",exp:"normal"},{serif:"今から！？面倒だわ…。",fukidashi:"normal",chara:"merry",pos:"right",exp:"normal"},{serif:"そんな事言わずに\n行きましょうよ。",fukidashi:"normal",chara:"renko",pos:"left",exp:"normal"},{serif:"うっ…急にめまいと\nフラつきと腹痛と頭痛が",fukidashi:"normal",chara:"merry",pos:"right",exp:"normal"},{serif:"さっきまで\n元気だったじゃない！",fukidashi:"normal",chara:"renko",pos:"left",exp:"normal"},{serif:"うーん、気が進まないわ。",fukidashi:"normal",chara:"merry",pos:"right",exp:"normal"},{serif:"はぁ…。そんなに嫌なら\n仕方ないわね。\n私一人で行ってくるわ。",fukidashi:"normal",chara:"renko",pos:"left",exp:"normal"}];e.exports=n},{}],14:[function(t,e,i){"use strict";var n={inherit:function(t,e){var i=function(t){if(Object.create)return Object.create(t);var e=function(){};return e.prototype=t,new e};t.prototype=i(e.prototype),t.prototype.constructor=t}};e.exports=n},{}]},{},[5]);